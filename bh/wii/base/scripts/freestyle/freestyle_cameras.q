freestyle_total_notes_change = 12
freestyle_camera_change_measures = 3
freestyle_cameras = {
	Guitar_CloseUp = [
		{
			suffix = 'cameras_guitar'
			Name = guitar_closeup_01
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_closeup_02
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_closeup_03
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_closeup_04
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_closeup_05
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_closeup_06
		}
	]
	guitar_zoom = [
		{
			suffix = 'cameras_guitar'
			Name = guitar_dolly_01
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_dolly_02
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_dolly_03
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_dolly_04
		}
	]
	guitar_orbit = [
		{
			suffix = 'cameras_guitar'
			Name = guitar_orbit_01
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_orbit_02
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_orbit_03
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_orbit_04
		}
	]
	guitar_stage = [
		{
			suffix = 'cameras_guitar'
			Name = guitar_stage_01
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_stage_02
		}
		{
			suffix = 'cameras_guitar'
			Name = guitar_stage_03
		}
	]
	drums_closeup = [
		{
			suffix = 'cameras_drums'
			Name = drums_closeup_01
		}
		{
			suffix = 'cameras_drums'
			Name = drums_closeup_02
		}
		{
			suffix = 'cameras_drums'
			Name = drums_closeup_03
		}
	]
	drums_zoom = [
		{
			suffix = 'cameras_drums'
			Name = drums_dolly_01
		}
		{
			suffix = 'cameras_drums'
			Name = drums_dolly_02
		}
		{
			suffix = 'cameras_drums'
			Name = drums_dolly_03
		}
		{
			suffix = 'cameras_drums'
			Name = drums_dolly_04
		}
	]
	drums_orbit = [
		{
			suffix = 'cameras_drums'
			Name = drums_orbit_01
		}
		{
			suffix = 'cameras_drums'
			Name = drums_orbit_02
		}
		{
			suffix = 'cameras_drums'
			Name = drums_orbit_03
		}
		{
			suffix = 'cameras_drums'
			Name = drums_orbit_04
		}
	]
	drums_stage = [
		{
			suffix = 'cameras_drums'
			Name = drums_stage_01
		}
		{
			suffix = 'cameras_drums'
			Name = drums_stage_02
		}
		{
			suffix = 'cameras_drums'
			Name = drums_stage_03
		}
	]
	bass_closeup = [
		{
			suffix = 'cameras_bass'
			Name = bass_closeup_01
		}
		{
			suffix = 'cameras_bass'
			Name = bass_closeup_02
		}
		{
			suffix = 'cameras_bass'
			Name = bass_closeup_03
		}
		{
			suffix = 'cameras_bass'
			Name = bass_closeup_04
		}
		{
			suffix = 'cameras_bass'
			Name = bass_closeup_05
		}
	]
	bass_zoom = [
		{
			suffix = 'cameras_bass'
			Name = bass_dolly_01
		}
		{
			suffix = 'cameras_bass'
			Name = bass_dolly_02
		}
		{
			suffix = 'cameras_bass'
			Name = bass_dolly_03
		}
		{
			suffix = 'cameras_bass'
			Name = bass_dolly_04
		}
	]
	bass_orbit = [
		{
			suffix = 'cameras_bass'
			Name = bass_orbit_01
		}
		{
			suffix = 'cameras_bass'
			Name = bass_orbit_02
		}
		{
			suffix = 'cameras_bass'
			Name = bass_orbit_03
		}
		{
			suffix = 'cameras_bass'
			Name = bass_orbit_04
		}
	]
	bass_stage = [
		{
			suffix = 'cameras_bass'
			Name = bass_stage_01
		}
		{
			suffix = 'cameras_bass'
			Name = bass_stage_02
		}
		{
			suffix = 'cameras_bass'
			Name = bass_stage_03
		}
	]
	band_wide = [
		{
			suffix = 'cameras_band'
			Name = band_wide_01
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_02
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_03
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_04
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_05
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_06
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_07
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_08
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_09
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_10
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_11
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_12
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_13
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_14
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_15
		}
		{
			suffix = 'cameras_band'
			Name = band_wide_16
		}
	]
	band_zoom = [
		{
			suffix = 'cameras_band'
			Name = band_zoom_01
		}
		{
			suffix = 'cameras_band'
			Name = band_zoom_02
		}
		{
			suffix = 'cameras_band'
			Name = band_zoom_03
		}
		{
			suffix = 'cameras_band'
			Name = band_zoom_04
		}
		{
			suffix = 'cameras_band'
			Name = band_zoom_05
		}
		{
			suffix = 'cameras_band'
			Name = band_zoom_06
		}
		{
			suffix = 'cameras_band'
			Name = band_zoom_07
		}
		{
			suffix = 'cameras_band'
			Name = band_zoom_08
		}
		{
			suffix = 'cameras_band'
			Name = band_zoom_09
		}
	]
	band_orbit = [
		{
			suffix = 'cameras_band'
			Name = band_orbit_01
		}
		{
			suffix = 'cameras_band'
			Name = band_orbit_02
		}
		{
			suffix = 'cameras_band'
			Name = band_orbit_03
		}
		{
			suffix = 'cameras_band'
			Name = band_orbit_04
		}
		{
			suffix = 'cameras_band'
			Name = band_orbit_05
		}
		{
			suffix = 'cameras_band'
			Name = band_orbit_06
		}
		{
			suffix = 'cameras_band'
			Name = band_orbit_07
		}
		{
			suffix = 'cameras_band'
			Name = band_orbit_08
		}
		{
			suffix = 'cameras_band'
			Name = band_orbit_09
		}
		{
			suffix = 'cameras_band'
			Name = band_orbit_10
		}
		{
			suffix = 'cameras_band'
			Name = band_orbit_11
		}
	]
	band_stage = [
		{
			suffix = 'cameras_band'
			Name = band_stage_01
		}
		{
			suffix = 'cameras_band'
			Name = band_stage_02
		}
		{
			suffix = 'cameras_band'
			Name = band_stage_03
		}
		{
			suffix = 'cameras_band'
			Name = band_stage_04
		}
		{
			suffix = 'cameras_band'
			Name = band_stage_05
		}
		{
			suffix = 'cameras_band'
			Name = band_stage_06
		}
		{
			suffix = 'cameras_band'
			Name = band_stage_07
		}
		{
			suffix = 'cameras_band'
			Name = band_stage_08
		}
		{
			suffix = 'cameras_band'
			Name = band_stage_09
		}
	]
	Intro = [
		{
			suffix = 'cameras'
			Name = venue_intro
		}
	]
	outro = [
		{
			suffix = 'cameras'
			Name = venue_outro
		}
	]
	menu = [
		{
			suffix = 'cameras'
			Name = venue_menu
		}
	]
	tutorial = [
		{
			suffix = 'cameras'
			Name = venue_tutorial
		}
	]
}
freestyle_individual_camera_type_suffixes = [
	'_closeup'
	'_zoom'
	'_orbit'
	'_stage'
]
freestyle_band_camera_types = [
	band_wide
	band_zoom
	band_orbit
	band_stage
]
freestyle_current_camera_type = None
freestyle_current_camera_idx = 0
freestyle_current_soloist = -1
freestyle_camera_change_measures_count = 0
freestyle_next_camera_type = band_long
freestyle_next_camera_priority = -1
freestyle_last_measure_start = -1

script freestyle_init_cameras 
	Change \{Default_TOD_Manager = $default_tod_manager_freestyle}
	freestyle_reset_camera_globals
endscript

script freestyle_deinit_cameras 
	KillCamAnim \{all}
	destroy_cameracuts
endscript

script freestyle_reset_camera_globals 
	Change \{freestyle_current_camera_type = None}
	Change \{freestyle_current_camera_idx = -1}
	Change \{freestyle_current_soloist = -1}
	Change \{freestyle_camera_change_measures_count = 0}
	Change \{freestyle_total_notes_played = 0}
	Change \{freestyle_total_notes_count = 0}
	Change \{freestyle_next_camera_type = band_long}
	Change \{freestyle_next_camera_priority = -1}
	Change \{freestyle_last_measure_start = -1}
endscript

script freestyle_change_camera 
	RequireParams \{[
			camera_type
			camera_index
		]
		all}
	if NOT StructureContains structure = ($freestyle_cameras) <camera_type>
		ScriptAssert \{qs(0xa4226803)}
		return \{FALSE}
	endif
	p = ($freestyle_cameras.<camera_type> [<camera_index>].suffix)
	n = ($freestyle_cameras.<camera_type> [<camera_index>].Name)
	if freestyle_change_guitar_camera suffix = <p> Name = <n>
		Change freestyle_current_camera_type = <camera_type>
		Change freestyle_current_camera_idx = <camera_index>
		freestyle_find_camera_type_index camera_type = <camera_type>
		freestylerecordcameraevent camera_type_index = <camera_type_index> camera_index = <camera_index>
		return \{true}
	else
		return \{FALSE}
	endif
endscript

script freestyle_change_guitar_camera 
	RequireParams \{[
			suffix
			Name
		]
		all}
	formatText checksumName = camera_array_name 'Z_Freestyle_%a' a = <suffix> AddToStringLookup = true
	if NOT GlobalExists Name = <camera_array_name> Type = array
		if NOT GotParam \{no_assert}
			ScriptAssert 'Incorrect array name!  %a does not exist in freestyle venue camera arrays.' a = <camera_array_name>
		endif
		return \{FALSE}
	endif
	GetArraySize $<camera_array_name>
	i = 0
	camera_index = 0
	begin
	if StructureContains structure = ($<camera_array_name> [<i>]) Name
		if ($<camera_array_name> [<i>].Name = <Name>)
			<camera_index> = <i>
			break
		endif
	endif
	<i> = (<i> + 1)
	repeat <array_Size>
	Change \{CameraCuts_ForceTime = 3.75}
	Change \{CameraCuts_ChangeNow = FALSE}
	SpawnScriptNow cameracuts_updatescreenfx params = {Camera_Array = <camera_array_name> newindex = <camera_index>}
	CamParams = ($<camera_array_name> [<camera_index>])
	cameracut_remapbandmemberlookats
	KillCamAnim \{all}
	PlayIGCCam {
		time = 0
		viewport = bg_viewport
		controlscript = CameraCuts_StaticCamControl
		params = {CamParams = <CamParams>}
		<CamParams>
		exitscript = empty_script
		play_hold = 1
		Name = CameraCutCam
		interrupt_current
	}
	return \{true}
endscript

script freestyle_choose_next_camera_index 
	RequireParams \{[
			camera_type
		]
		all}
	if NOT StructureContains structure = ($freestyle_cameras) <camera_type>
		ScriptAssert \{qs(0xa2bae866)}
		return
	endif
	GetArraySize ($freestyle_cameras.<camera_type>)
	chosen_index = 0
	GetRandomValue Name = rand integer a = 0 b = (<array_Size> - 1)
	if ((<rand> = $freestyle_current_camera_idx) && (<camera_type> = $freestyle_current_camera_type))
		<rand> = (<rand> + 1)
		if (<rand> >= <array_Size>)
			<rand> = 0
		endif
	endif
	return chosen_index = <rand>
endscript

script freestyle_update_camera 
	if (($freestyle_auto_stage_show = FALSE) || ($freestyle_last_nowbar_beat_number < 0) || ($freestyle_transition_state != gameplay))
		return
	endif
	change_camera = FALSE
	if ($freestyle_last_nowbar_beat_number >= ($freestyle_camera_change_measures_count + ($freestyle_camera_change_measures * $freestyle_beats_per_measure)))
		Change freestyle_camera_change_measures_count = ($freestyle_last_nowbar_beat_number)
		change_camera = true
	endif
	if ($freestyle_total_notes_played >= ($freestyle_total_notes_count + $freestyle_total_notes_change))
		Change freestyle_total_notes_count = ($freestyle_total_notes_played)
		change_camera = true
	endif
	if (<change_camera> = true)
		freestyle_choose_appropriate_camera
	endif
	Mod \{a = $freestyle_last_nowbar_beat_number
		b = $freestyle_beats_per_measure}
	if ((<Mod> = 0) && ($freestyle_next_camera_priority > -1) && ($freestyle_last_measure_start < $freestyle_last_nowbar_beat_number))
		freestyle_choose_next_camera_index \{camera_type = $freestyle_next_camera_type}
		freestyle_change_camera camera_type = ($freestyle_next_camera_type) camera_index = <chosen_index>
		freestyle_reset_next_camera_data
		Change freestyle_last_measure_start = ($freestyle_last_nowbar_beat_number)
		Change freestyle_total_notes_count = ($freestyle_total_notes_played)
	endif
endscript

script freestyle_choose_appropriate_camera \{Priority = 0}
	if ($freestyle_auto_stage_show = FALSE)
		return
	endif
	GetArraySize ($freestyle_current_solo_players)
	solo_count = <array_Size>
	if (<solo_count> > 0)
		GetRandomValue Name = solo_index a = 0 b = (<solo_count> - 1) integer
		solo_player = ($freestyle_current_solo_players [<solo_index>])
		if (<solo_count> > 1)
			if (<solo_player> = $freestyle_current_soloist)
				<solo_index> = (<solo_index> + 1)
				if (<solo_index> >= <solo_count>)
					<solo_index> = 0
				endif
				<solo_player> = ($freestyle_current_solo_players [<solo_index>])
			endif
		endif
		freestyle_new_solo_camera Player = <solo_player> Priority = <Priority>
	else
		freestyle_new_non_solo_camera Priority = <Priority>
	endif
endscript

script freestyle_new_solo_camera \{Player = 0
		Priority = 0}
	if ($freestyle_auto_stage_show = FALSE)
		return
	endif
	Change freestyle_current_soloist = <Player>
	GetArraySize ($freestyle_individual_camera_type_suffixes)
	GetRandomValue Name = type_index integer a = 0 b = (<array_Size> - 1)
	ExtendCrc ($freestyle_player_data [<Player>].instrument) ($freestyle_individual_camera_type_suffixes [<type_index>]) out = camtype
	freestyle_make_next_camera_request camera_type = <camtype> Priority = <Priority>
endscript

script freestyle_new_non_solo_camera \{Priority = 0}
	if ($freestyle_auto_stage_show = FALSE)
		return
	endif
	Change \{freestyle_current_soloist = -1}
	GetArraySize ($freestyle_band_camera_types)
	GetRandomValue Name = type_index integer a = 0 b = (<array_Size> - 1)
	freestyle_make_next_camera_request camera_type = ($freestyle_band_camera_types [<type_index>]) Priority = <Priority>
endscript

script freestyle_make_next_camera_request 
	if (<Priority> > $freestyle_next_camera_priority)
		Change freestyle_next_camera_type = <camera_type>
		Change freestyle_next_camera_priority = <Priority>
	endif
endscript

script freestyle_reset_next_camera_data 
	Change \{freestyle_next_camera_type = band_long}
	Change \{freestyle_next_camera_priority = -1}
endscript
freestyle_total_notes_played = 0
freestyle_total_notes_count = 0

script freestyle_increment_total_notes_played \{Player = 0}
	if (($freestyle_player_data [<Player>].player_type) = human)
		Change freestyle_total_notes_played = ($freestyle_total_notes_played + 1)
	endif
endscript

script freestyle_change_to_intro_camera 
	if ($freestyle_auto_stage_show = FALSE)
		return
	endif
	freestyle_choose_next_camera_index \{camera_type = Intro}
	freestyle_change_camera camera_type = Intro camera_index = <chosen_index>
endscript

script freestyle_change_to_outro_camera 
	if (($freestyle_auto_stage_show = FALSE) && ($freestyle_forced_outro = 0))
		return
	endif
	freestyle_choose_next_camera_index \{camera_type = outro}
	freestyle_change_camera camera_type = outro camera_index = <chosen_index>
endscript
freestyle_debug_camera_no_show = FALSE

script free_cam 
	use_cam = 'none'
	use_name = None
	if GotParam \{near}
		use_cam = 'cameras'
		use_name = generic_stage_shot
	elseif GotParam \{medium}
		use_cam = 'cameras'
		use_name = venue_midshot
	elseif GotParam \{far}
		use_cam = 'cameras'
		use_name = LongShot
	elseif GotParam \{orbit}
		use_cam = 'cameras_Orbits'
		use_name = orbit_low
	elseif GotParam \{auto}
		printf \{'Restore auto-stage-show.'}
		freestyle_enable_auto_stage_show
		if ($debug_showcameraname = On)
			freestyle_toggle_showcameraname
		endif
		return
	else
		if GotParam \{cam}
			use_cam = <cam>
		endif
		if GotParam \{Name}
			use_name = <Name>
		endif
		if ((<use_cam> = 'none') || (<use_name> = None))
			freestyle_camera_print_usage
			printstruct <...>
			ScriptAssert \{'Bad or no parameters'}
		endif
	endif
	if GotParam \{show_cam}
		if (<show_cam> = OFF)
			Change \{freestyle_debug_camera_no_show = true}
		else
			Change \{freestyle_debug_camera_no_show = FALSE}
		endif
	endif
	freestyle_disable_auto_stage_show
	if NOT ($freestyle_debug_camera_no_show = true)
		if ($debug_showcameraname = OFF)
			freestyle_toggle_showcameraname
		endif
	else
		if ($debug_showcameraname = On)
			freestyle_toggle_showcameraname
		endif
	endif
	if NOT freestyle_change_guitar_camera suffix = <use_cam> Name = <use_name> no_assert
		printf \{'Invalid camera specified.'}
		freestyle_camera_print_usage
	endif
endscript

script freestyle_camera_print_usage 
	printf \{'Must specify camera ID to use: [near | medium | far | orbit]'}
	printf \{'Or camera array & name:  cam=\'camera_array\'  name=camera_name.  Yes the single \'quotes\' are required.'}
	printf \{'   Eg.  cam=\'cameras_drums\'  will use array  Z_Freestyle_cameras_drums. name is a field for the camera to use.'}
	printf \{'Or return to auto-stage-show:  auto'}
	printf \{'Can also turn off (or back on) display of debug camera name:  show_cam=[on | off]'}
endscript

script freestyle_toggle_showcameraname 
	if ScreenElementExists \{id = debug_camera_name_text}
		DestroyScreenElement \{id = debug_camera_name_text}
	endif
	if ScreenElementExists \{id = debug_camera_anim_text}
		DestroyScreenElement \{id = debug_camera_anim_text}
	endif
	if ScreenElementExists \{id = debug_camera_name_text2}
		DestroyScreenElement \{id = debug_camera_name_text2}
	endif
	if ScreenElementExists \{id = debug_camera_name_bg}
		DestroyScreenElement \{id = debug_camera_name_bg}
	endif
	if ($debug_showcameraname = OFF)
		Change \{debug_showcameraname = On}
	else
		Change \{debug_showcameraname = OFF}
	endif
	if ($debug_showcameraname = On)
		CameraCuts_UpdateDebugCameraName
	endif
endscript
