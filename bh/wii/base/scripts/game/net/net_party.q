temp_net_id = [
	{
		net_id_first = 0
		net_id_second = 0
		Name = qs(0x00000000)
		lefty_flip = 0
		mic_preference = None
		mic_type = None
		vocals_highway_view = scrolling
		character_id = gh_rocker_judy
		stored_character_index = 0
		character_savegame = -1
		double_kick = 0
		difficulty = medium
		part = None
		Cheat_Hyperspeed = 0
		cheat_hyperspeed_value = 1.0
		use_tilt_for_starpower = 1
		enable_touch_strip = 1
	}
	{
		net_id_first = 0
		net_id_second = 0
		Name = qs(0x00000000)
		lefty_flip = 0
		mic_preference = None
		mic_type = None
		vocals_highway_view = scrolling
		character_id = gh_rocker_judy
		stored_character_index = 0
		character_savegame = -1
		double_kick = 0
		difficulty = medium
		part = None
		Cheat_Hyperspeed = 0
		cheat_hyperspeed_value = 1.0
		use_tilt_for_starpower = 1
		enable_touch_strip = 1
	}
	{
		net_id_first = 0
		net_id_second = 0
		Name = qs(0x00000000)
		lefty_flip = 0
		mic_preference = None
		mic_type = None
		vocals_highway_view = scrolling
		character_id = gh_rocker_judy
		stored_character_index = 0
		character_savegame = -1
		double_kick = 0
		difficulty = medium
		part = None
		Cheat_Hyperspeed = 0
		cheat_hyperspeed_value = 1.0
		use_tilt_for_starpower = 1
		enable_touch_strip = 1
	}
	{
		net_id_first = 0
		net_id_second = 0
		Name = qs(0x00000000)
		lefty_flip = 0
		mic_preference = None
		mic_type = None
		vocals_highway_view = scrolling
		character_id = gh_rocker_judy
		stored_character_index = 0
		character_savegame = -1
		double_kick = 0
		difficulty = medium
		part = None
		Cheat_Hyperspeed = 0
		cheat_hyperspeed_value = 1.0
		use_tilt_for_starpower = 1
		enable_touch_strip = 1
	}
	{
		net_id_first = 0
		net_id_second = 0
		Name = qs(0x00000000)
		lefty_flip = 0
		mic_preference = None
		mic_type = None
		vocals_highway_view = scrolling
		character_id = gh_rocker_judy
		stored_character_index = 0
		character_savegame = -1
		double_kick = 0
		difficulty = medium
		part = None
		Cheat_Hyperspeed = 0
		cheat_hyperspeed_value = 1.0
		use_tilt_for_starpower = 1
		enable_touch_strip = 1
	}
	{
		net_id_first = 0
		net_id_second = 0
		Name = qs(0x00000000)
		lefty_flip = 0
		mic_preference = None
		mic_type = None
		vocals_highway_view = scrolling
		character_id = gh_rocker_judy
		stored_character_index = 0
		character_savegame = -1
		double_kick = 0
		difficulty = medium
		part = None
		Cheat_Hyperspeed = 0
		cheat_hyperspeed_value = 1.0
		use_tilt_for_starpower = 1
		enable_touch_strip = 1
	}
	{
		net_id_first = 0
		net_id_second = 0
		Name = qs(0x00000000)
		lefty_flip = 0
		mic_preference = None
		mic_type = None
		vocals_highway_view = scrolling
		character_id = gh_rocker_judy
		stored_character_index = 0
		character_savegame = -1
		double_kick = 0
		difficulty = medium
		part = None
		Cheat_Hyperspeed = 0
		cheat_hyperspeed_value = 1.0
		use_tilt_for_starpower = 1
		enable_touch_strip = 1
	}
]

script clear_temp_net_id_array 
	Change \{temp_net_id = [
			{
				net_id_first = 0
				net_id_second = 0
				Name = qs(0x00000000)
				lefty_flip = 0
				mic_preference = None
				mic_type = None
				vocals_highway_view = scrolling
				character_id = gh_rocker_judy
				stored_character_index = 0
				character_savegame = -1
				double_kick = 0
				difficulty = medium
				part = None
				Cheat_Hyperspeed = 0
				cheat_hyperspeed_value = 1.0
				use_tilt_for_starpower = 1
				enable_touch_strip = 1
			}
			{
				net_id_first = 0
				net_id_second = 0
				Name = qs(0x00000000)
				lefty_flip = 0
				mic_preference = None
				mic_type = None
				vocals_highway_view = scrolling
				character_id = gh_rocker_judy
				stored_character_index = 0
				character_savegame = -1
				double_kick = 0
				difficulty = medium
				part = None
				Cheat_Hyperspeed = 0
				cheat_hyperspeed_value = 1.0
				use_tilt_for_starpower = 1
				enable_touch_strip = 1
			}
			{
				net_id_first = 0
				net_id_second = 0
				Name = qs(0x00000000)
				lefty_flip = 0
				mic_preference = None
				mic_type = None
				vocals_highway_view = scrolling
				character_id = gh_rocker_judy
				stored_character_index = 0
				character_savegame = -1
				double_kick = 0
				difficulty = medium
				part = None
				Cheat_Hyperspeed = 0
				cheat_hyperspeed_value = 1.0
				use_tilt_for_starpower = 1
				enable_touch_strip = 1
			}
			{
				net_id_first = 0
				net_id_second = 0
				Name = qs(0x00000000)
				lefty_flip = 0
				mic_preference = None
				mic_type = None
				vocals_highway_view = scrolling
				character_id = gh_rocker_judy
				stored_character_index = 0
				character_savegame = -1
				double_kick = 0
				difficulty = medium
				part = None
				Cheat_Hyperspeed = 0
				cheat_hyperspeed_value = 1.0
				use_tilt_for_starpower = 1
				enable_touch_strip = 1
			}
			{
				net_id_first = 0
				net_id_second = 0
				Name = qs(0x00000000)
				lefty_flip = 0
				mic_preference = None
				mic_type = None
				vocals_highway_view = scrolling
				character_id = gh_rocker_judy
				stored_character_index = 0
				character_savegame = -1
				double_kick = 0
				difficulty = medium
				part = None
				Cheat_Hyperspeed = 0
				cheat_hyperspeed_value = 1.0
				use_tilt_for_starpower = 1
				enable_touch_strip = 1
			}
			{
				net_id_first = 0
				net_id_second = 0
				Name = qs(0x00000000)
				lefty_flip = 0
				mic_preference = None
				mic_type = None
				vocals_highway_view = scrolling
				character_id = gh_rocker_judy
				stored_character_index = 0
				character_savegame = -1
				double_kick = 0
				difficulty = medium
				part = None
				Cheat_Hyperspeed = 0
				cheat_hyperspeed_value = 1.0
				use_tilt_for_starpower = 1
				enable_touch_strip = 1
			}
			{
				net_id_first = 0
				net_id_second = 0
				Name = qs(0x00000000)
				lefty_flip = 0
				mic_preference = None
				mic_type = None
				vocals_highway_view = scrolling
				character_id = gh_rocker_judy
				stored_character_index = 0
				character_savegame = -1
				double_kick = 0
				difficulty = medium
				part = None
				Cheat_Hyperspeed = 0
				cheat_hyperspeed_value = 1.0
				use_tilt_for_starpower = 1
				enable_touch_strip = 1
			}
		]}
endscript

script setup_temp_net_id_array 
	getnumplayersingame \{local}
	if (<num_players> > 0)
		getfirstplayer \{local}
		begin
		set_player_temp_net_id_array Player = <Player>
		getnextplayer local Player = <Player>
		repeat <num_players>
	endif
endscript

script set_player_temp_net_id_array 
	RequireParams \{[
			Player
		]
		all}
	getplayerinfo <Player> controller
	if NetSessionFunc func = iscontrolleringame params = {controller = <controller>}
		GetNetID controller_index = (<controller>)
		NetSessionFunc func = get_gamertag params = {controller = <controller>}
		getplayerinfo <Player> lefty_flip
		getplayerinfo <Player> mic_type
		getplayerinfo <Player> mic_preference
		getplayerinfo <Player> character_savegame
		getplayerinfo <Player> character_id
		getplayerinfo <Player> double_kick_drum
		getplayerinfo <Player> difficulty
		getplayerinfo <Player> stored_character_index
		getplayerinfo <Player> part
		getplayerinfo <Player> Cheat_Hyperspeed
		getplayerinfo <Player> cheat_hyperspeed_value
		getplayerinfo <Player> vocals_highway_view
		getplayerinfo <Player> enable_touch_strip
		getplayerinfo <Player> use_tilt_for_starpower
		SetArrayElement {
			ArrayName = temp_net_id
			globalarray
			index = <controller>
			NewValue = {
				net_id_first = <net_id_first>
				net_id_second = <net_id_second>
				Name = <Name>
				lefty_flip = <lefty_flip>
				mic_type = <mic_type>
				mic_preference = <mic_preference>
				character_savegame = <character_savegame>
				character_id = <character_id>
				stored_character_index = <stored_character_index>
				double_kick = <double_kick_drum>
				difficulty = <difficulty>
				part = <part>
				Cheat_Hyperspeed = <Cheat_Hyperspeed>
				cheat_hyperspeed_value = <cheat_hyperspeed_value>
				vocals_highway_view = <vocals_highway_view>
				enable_touch_strip = <enable_touch_strip>
				use_tilt_for_starpower = <use_tilt_for_starpower>
			}
		}
	endif
endscript

script net_party_save_off_invite_controllers 
	printf \{qs(0x6ce8d99e)}
	get_local_players_in_game
	GetArraySize \{local_players}
	if (<array_Size> > 0)
		i = 0
		begin
		if ((<local_players> [<i>]) = 1)
			GetNetID controller_index = <i>
			NetSessionFunc func = get_gamertag params = {controller = <i>}
			SetArrayElement {
				globalarray
				ArrayName = temp_net_id
				index = <i>
				NewValue = {
					net_id_first = <net_id_first>
					net_id_second = <net_id_second>
					Name = <Name>
				}
			}
		endif
		i = (<i> + 1)
		repeat <array_Size>
	endif
endscript

script net_party_can_accept_new_players 
	printf \{qs(0x2334dcd0)}
	can_join = 1
	return can_join = <can_join>
endscript

script net_party_leave_current_game 
	printf \{qs(0x33bef1ce)}
	destroy_player_drop_events
	quit_network_game_early
	band_lobby_restore_prematchmaking_settings
	career_end_challenge
	StartRendering
	destroy_net_popup
	UnPauseGame
	ui_event_wait_for_safe
	if ($g_band_lobby_flag = 1)
		generic_event_back \{state = uistate_band_lobby_setup}
	else
		ScriptAssert \{'DEPRECATED FLOW'}
	endif
endscript

script net_party_host_cancel_matchmaking 
	printf \{qs(0x5d5cc043)}
	if ($g_career_search = party_join)
		Change \{g_career_search = NULL}
		band_lobby_return_from_matchmaking
		band_lobby_flash_ticker_msg \{msg_checksum = party_host_cancel_matchmake
			time = 6}
	endif
endscript

script net_party_host_started_matchmaking 
	printf \{qs(0xea82e4e2)}
	ui_event_get_top
	if GotParam \{is_popup}
		ui_event \{event = menu_back}
	endif
	if GotParam \{game_mode}
		Change game_mode = <game_mode>
		if (<game_mode> = career)
			gamemode_updatenumplayers \{num_players = 4}
			gamemode_updatecooperative \{cooperative = 1}
			Change \{g_lobby_state = career}
		elseif (<game_mode> = quickplay)
			Change \{g_lobby_state = quickplay}
		else
			Change \{g_lobby_state = vs}
		endif
	endif
	if GotParam \{competitive_rules}
		Change competitive_rules = <competitive_rules>
	endif
	if GotParam \{private}
		private = <private>
	else
		private = 0
	endif
	Change \{g_career_search = party_join}
	printstruct <...>
	band_lobby_party_host_started_matchmaking private = <private>
endscript

script net_party_attempted_join_result 
	printf \{qs(0x781f28a3)}
	RequireParams \{[
			join_result
			join_mode
		]
		all}
	Change \{has_invite_join_result_callback_completed = 1}
	if (<join_result> = 1)
		Change \{g_lobby_enter_from_main_menu = 0}
		printf \{qs(0x9014f167)}
		if ($game_mode = freeplay)
			printf \{'net_party_attempted_join_result: SETTING GAME MODE TO CAREER'}
			Change \{game_mode = career}
		endif
		if (<join_mode> = quckplay_join)
			Change \{g_lobby_state = quickplay}
		elseif (<join_mode> = career_join)
			Change \{g_lobby_state = career}
		elseif (<join_mode> = competitive_join)
			Change \{g_lobby_state = vs}
		endif
		Change \{g_lobby_net_state = net_private}
		NetSessionFunc \{Obj = party
			func = get_party_members}
		GetArraySize \{connections}
		if (<array_Size> > 0)
			<got_players> = 0
			begin
			NetSessionFunc \{Obj = party
				func = get_party_members}
			GetArraySize \{connections}
			i = 0
			if (<array_Size> > 0)
				begin
				if ((<connections> [<i>].is_local) = 1 && (<connections> [<i>].party_id) != 255)
					<got_players> = 1
					getnumplayersingame \{local
						out = num_local_players}
					RemoveParameter \{local_primary_joining}
					if (<num_local_players> = 0)
						local_primary_joining = 1
					endif
					band_lobby_add_player_to_playerinfo player_type = party data = (<connections> [<i>]) local_primary_joining = <local_primary_joining>
					if ((<connections> [<i>].controller_index) = ($primary_controller))
						Change g_leader_player_num = <playerinfo>
					endif
				endif
				i = (<i> + 1)
				repeat <array_Size>
			endif
			if (<got_players> = 1)
				break
			else
				Wait \{1
					Second}
			endif
			repeat 60
			if (<got_players> = 0)
				<join_result> = 0
			endif
		endif
		Change \{g_net_leader_player_num = -1}
		StopRendering
		destroy_loading_screen
		set_home_button_notallowed
		ui_event \{event = menu_change
			data = {
				state = uistate_band_lobby_setup
			}}
	endif
	if (<join_result> = 0)
		shut_down_net_play
		NetSessionFunc \{Obj = party
			func = stop_party_session}
		printf \{qs(0x71dfc671)}
		if ((isps3) || (isngc))
			popup_text = qs(0x366e10c6)
			if GotParam \{reason}
				if (<reason> = bad_state)
					<popup_text> = qs(0x33923e7f)
				endif
			endif
		else
			popup_text = qs(0x4e216451)
			if GotParam \{reason}
				if (<reason> = bad_state)
					<popup_text> = qs(0x3c913dd8)
				endif
			endif
		endif
		create_dialog_box {
			heading_text = qs(0x4d21d20e)
			body_text = <popup_text>
			options = [
				{
					func = net_party_failed_join_attempt_continue
					text = qs(0x182f0173)
				}
			]
		}
		destroy_loading_screen
	endif
	Change \{invite_controller = -1}
endscript

script net_party_failed_join_attempt_continue 
	destroy_dialog_box
	clean_up_user_control_helpers
	ui_event \{event = menu_refresh
		data = {
			lost_party
			refresh_animate
		}}
endscript

script net_party_lost_party_connection 
	printf \{qs(0xb6121789)}
	ui_event_get_stack
	if NOT ((<stack> [0].base_name) = 'mainmenu')
		if bl_is_in_band_lobby_menus
			Change g_net_leader_player_num = ($g_leader_player_num)
			Change g_copy_leader_player_num = ($g_leader_player_num)
			Change g_copy_net_leader_player_num = ($g_net_leader_player_num)
			Change \{g_career_search = NULL}
			band_lobby_destroy_popup_menu
			getnumplayersingame \{remote}
			if (<num_players> > 0)
				getfirstplayer \{remote}
				begin
				net_clear_player_info Player = <Player>
				getnextplayer Player = <Player> remote
				repeat <num_players>
			endif
			band_lobby_add_in_game_players_to_party
			band_lobby_clear_all_viewports_data
			<Player> = 1
			begin
			formatText checksumName = musician_value 'musician%p' p = <Player>
			setplayerinfo <Player> band_member = <musician_value>
			<Player> = (<Player> + 1)
			repeat 4
			if ScreenElementExists \{id = band_lobby_desc_id}
				band_lobby_desc_id :se_setprops \{block_events}
			endif
			create_net_popup \{title = qs(0x5ca2c535)
				popup_text = qs(0xc4ad8373)}
			SpawnScriptNow \{net_party_lost_party_connection_kill_popup}
		else
			band_lobby_add_in_game_players_to_party
			band_lobby_set_party_joinable \{joinable = 0}
		endif
	endif
endscript

script net_party_lost_party_connection_kill_popup 
	Wait \{3
		Seconds}
	ui_event_wait_for_safe
	ui_event_get_stack
	if ((<stack> [0].base_name) = 'connection_loss')
		return
	endif
	if ScreenElementExists \{id = band_lobby_desc_id}
		begin
		if NOT savegame_async_is_busy
			break
		endif
		Wait \{1
			gameframe}
		repeat
		ui_event \{event = menu_back
			data = {
				state = uistate_band_lobby_setup
			}}
		begin
		ui_event_wait_for_safe
		ui_event_get_stack
		if ((<stack> [0].base_name) = 'band_lobby')
			ui_event_wait_for_safe
			break
		endif
		Wait \{1
			gameframe}
		repeat
		destroy_net_popup
		band_lobby_update_button_helpers
		return
	endif
	destroy_net_popup
endscript

script net_party_receive_host_party_info 
	printf \{qs(0x3529c519)}
endscript

script net_party_handle_host_migration 
	printf \{qs(0xe3b5f2c3)}
	printstruct <...>
	if checksumequals a = <Result> b = success
		printf \{qs(0x9f63d52c)}
	elseif checksumequals a = <Result> b = failed
		printf \{qs(0xff917b1d)}
	elseif checksumequals a = <Result> b = started
		printf \{qs(0xe4b8150d)}
	else
		printf \{qs(0x6c4e4835)}
	endif
endscript

script net_party_add_player_late_result 
	printf \{qs(0x837240cf)}
	printstruct <...>
	if bl_is_in_band_lobby_menus
		band_lobby_wait_for_menu_update submenu_index = <controller_index>
		if (<join_result> = 1)
			getplayerinfo (<controller_index> + 1) in_game
			getplayerinfo (<controller_index> + 1) is_local_client
			if ((<in_game> = 0) || (<in_game> = 1 && <is_local_client> = 0))
				band_lobby_join submenu_index = <controller_index> device_num = <controller_index>
			endif
		else
			band_lobby_failed_join controller = <controller_index>
		endif
	endif
endscript

script net_party_debug_dump 
	printf \{qs(0x5243db76)}
	NetSessionFunc \{Obj = party
		func = get_party_members}
	printstruct <...>
endscript
