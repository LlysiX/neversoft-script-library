whammy_units_per_second = 6.3500004
prefretbar_time = 0.0
current_startup_script = nothing
current_exit_script = nothing
minimum_transition_load_time = 0.0
finished_gig_band_rebuild = 0
use_old_system_setup = 1
num_song_columns = 2
gem_colors = [
	green
	red
	yellow
	blue
	orange
	white
]
gem_colors_text = [
	'green'
	'red'
	'yellow'
	'blue'
	'orange'
	'white'
]
broken_strings = [
	broken_string_green
	broken_string_red
	broken_string_yellow
	broken_string_blue
	broken_string_orange
	broken_string_white
]
0x2994109a = [
	0x7aa563f4
	player1_status
	player2_status
	player3_status
	player4_status
	player5_status
	player6_status
	player7_status
	player8_status
]
0x57e22f28 = [
	'pX'
	'p1'
	'p2'
	'p3'
	'p4'
	'p5'
	'p6'
	'p7'
	'p8'
]
0xa025a029 = ''
0x37e424bf = FALSE
scripts_array = [
	{
		Name = 'scripts'
		lead_ms = 0
	}
	{
		Name = 'anim'
		lead_ms = 0
	}
	{
		Name = 'crowd'
		lead_ms = 0
	}
	{
		Name = 'drums'
		lead_ms = $time_drum_midi_offset_with_lag
	}
	{
		Name = 'scriptevents'
		lead_ms = 0
	}
	{
		Name = 'facial'
		lead_ms = 0
	}
]
fretbar_end_scale = 0.48000002
gray_gems = 0
0xdd4f68fd = 0
ps2_gameplay_restart_song = 0
button_models = [
	{
		green = {
			gem_material = mat_gem_green
			gem_hammer_material = mat_gem_hammer_green
			star_material = mat_star_green
			star_hammer_material = mat_star_hammer_green
			whammy_material = mat_whammy_green
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_green
			solo_star_material = mat_solo_star_green
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_green
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_green
			star_material_drum = mat_drum_star_green
			star_power_material_drum = mat_drum_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_drum_accent_green
			star_material_drum_accent = mat_drum_star_accent_green
			star_power_material_drum_accent = mat_drum_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_g
			icon_pos = (130.0, 100.0)
		}
		red = {
			gem_material = mat_gem_red
			gem_hammer_material = mat_gem_hammer_red
			star_material = mat_star_red
			star_hammer_material = mat_star_hammer_red
			whammy_material = mat_whammy_red
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_red
			solo_star_material = mat_solo_star_red
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_red
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_red
			star_material_drum = mat_drum_star_red
			star_power_material_drum = mat_drum_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_drum_accent_red
			star_material_drum_accent = mat_drum_star_accent_red
			star_power_material_drum_accent = mat_drum_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_r
			icon_pos = (130.0, 100.0)
		}
		yellow = {
			gem_material = mat_gem_yellow
			gem_hammer_material = mat_gem_hammer_yellow
			star_material = mat_star_yellow
			star_hammer_material = mat_star_hammer_yellow
			whammy_material = mat_whammy_yellow
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_yellow
			solo_star_material = mat_solo_star_yellow
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_yellow
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_cym_yellow
			star_material_drum = mat_drum_star_yellow
			star_power_material_drum = mat_cym_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_cym_accent_yellow
			star_material_drum_accent = mat_drum_star_accent_yellow
			star_power_material_drum_accent = mat_cym_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_y
			icon_pos = (130.0, 100.0)
		}
		blue = {
			gem_material = mat_gem_blue
			gem_hammer_material = mat_gem_hammer_blue
			star_material = mat_star_blue
			star_hammer_material = mat_star_hammer_blue
			whammy_material = mat_whammy_blue
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_blue
			solo_star_material = mat_solo_star_blue
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_blue
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_blue
			star_material_drum = mat_drum_star_blue
			star_power_material_drum = mat_drum_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_drum_accent_blue
			star_material_drum_accent = mat_drum_star_accent_blue
			star_power_material_drum_accent = mat_drum_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_b
			icon_pos = (130.0, 100.0)
		}
		orange = {
			gem_material = mat_gem_orange
			gem_hammer_material = mat_gem_hammer_orange
			star_material = mat_star_orange
			star_hammer_material = mat_star_hammer_orange
			whammy_material = mat_whammy_orange
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_orange
			solo_star_material = mat_solo_star_orange
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_orange
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_cym_orange
			star_material_drum = mat_drum_star_orange
			star_power_material_drum = mat_cym_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_cym_accent_orange
			star_material_drum_accent = mat_drum_star_accent_orange
			star_power_material_drum_accent = mat_cym_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_o
			icon_pos = (130.0, 100.0)
		}
		white = {
			gem_material = mat_open_note
			gem_hammer_material = mat_open_note_hammer
			star_material = mat_open_note_star
			star_hammer_material = mat_open_note_star_hammer
			whammy_material = mat_placeholder
			star_power_material = mat_open_note_star_power
			star_power_star_material = mat_open_note_star_power_star
			star_power_hammer_star_material = mat_open_note_star_power_star_hammer
			star_power_hammer_material = mat_open_note_star_power_hammer
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_placeholder
			solo_star_material = mat_placeholder
			solo_star_power_material = mat_placeholder
			solo_star_power_star_material = mat_placeholder
			solo_whammy_material = mat_placeholder
			solo_whammy_star_material = mat_placeholder
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_kickdrum
			star_material_drum = mat_drum_kickdrum_star
			star_power_material_drum = mat_drum_kickdrum_star_power
			star_power_star_material_drum = mat_drum_kickdrum_star_power_star
			gem_material_beginner = mat_kid_gem
			star_material_beginner = mat_kid_gem_star
			star_power_material_beginner = mat_kid_gem_star_power
			Name = button_b
			icon_pos = (256.0, 0.0)
		}
	}
	{
		green = {
			gem_material = mat_gem_green
			gem_hammer_material = mat_gem_hammer_green
			star_material = mat_star_green
			star_hammer_material = mat_star_hammer_green
			whammy_material = mat_whammy_green
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_green
			solo_star_material = mat_solo_star_green
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_green
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_green
			star_material_drum = mat_drum_star_green
			star_power_material_drum = mat_drum_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_drum_accent_green
			star_material_drum_accent = mat_drum_star_accent_green
			star_power_material_drum_accent = mat_drum_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_g
			icon_pos = (130.0, 100.0)
		}
		red = {
			gem_material = mat_gem_red
			gem_hammer_material = mat_gem_hammer_red
			star_material = mat_star_red
			star_hammer_material = mat_star_hammer_red
			whammy_material = mat_whammy_red
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_red
			solo_star_material = mat_solo_star_red
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_red
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_red
			star_material_drum = mat_drum_star_red
			star_power_material_drum = mat_drum_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_drum_accent_red
			star_material_drum_accent = mat_drum_star_accent_red
			star_power_material_drum_accent = mat_drum_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_r
			icon_pos = (130.0, 100.0)
		}
		yellow = {
			gem_material = mat_gem_yellow
			gem_hammer_material = mat_gem_hammer_yellow
			star_material = mat_star_yellow
			star_hammer_material = mat_star_hammer_yellow
			whammy_material = mat_whammy_yellow
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_yellow
			solo_star_material = mat_solo_star_yellow
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_yellow
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_cym_yellow
			star_material_drum = mat_drum_star_yellow
			star_power_material_drum = mat_cym_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_cym_accent_yellow
			star_material_drum_accent = mat_drum_star_accent_yellow
			star_power_material_drum_accent = mat_cym_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_y
			icon_pos = (130.0, 100.0)
		}
		blue = {
			gem_material = mat_gem_blue
			gem_hammer_material = mat_gem_hammer_blue
			star_material = mat_star_blue
			star_hammer_material = mat_star_hammer_blue
			whammy_material = mat_whammy_blue
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_blue
			solo_star_material = mat_solo_star_blue
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_blue
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_blue
			star_material_drum = mat_drum_star_blue
			star_power_material_drum = mat_drum_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_drum_accent_blue
			star_material_drum_accent = mat_drum_star_accent_blue
			star_power_material_drum_accent = mat_drum_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_b
			icon_pos = (130.0, 100.0)
		}
		orange = {
			gem_material = mat_gem_orange
			gem_hammer_material = mat_gem_hammer_orange
			star_material = mat_star_orange
			star_hammer_material = mat_star_hammer_orange
			whammy_material = mat_whammy_orange
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_orange
			solo_star_material = mat_solo_star_orange
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_orange
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_cym_orange
			star_material_drum = mat_drum_star_orange
			star_power_material_drum = mat_cym_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_cym_accent_orange
			star_material_drum_accent = mat_drum_star_accent_orange
			star_power_material_drum_accent = mat_cym_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_o
			icon_pos = (130.0, 100.0)
		}
		white = {
			gem_material = mat_open_note
			gem_hammer_material = mat_open_note_hammer
			star_material = mat_open_note_star
			star_hammer_material = mat_open_note_star_hammer
			whammy_material = mat_placeholder
			star_power_material = mat_open_note_star_power
			star_power_star_material = mat_open_note_star_power_star
			star_power_hammer_star_material = mat_open_note_star_power_star_hammer
			star_power_hammer_material = mat_open_note_star_power_hammer
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_placeholder
			solo_star_material = mat_placeholder
			solo_star_power_material = mat_placeholder
			solo_star_power_star_material = mat_placeholder
			solo_whammy_material = mat_placeholder
			solo_whammy_star_material = mat_placeholder
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_kickdrum
			star_material_drum = mat_drum_kickdrum_star
			star_power_material_drum = mat_drum_kickdrum_star_power
			star_power_star_material_drum = mat_drum_kickdrum_star_power_star
			gem_material_beginner = mat_kid_gem
			star_material_beginner = mat_kid_gem_star
			star_power_material_beginner = mat_kid_gem_star_power
			Name = button_b
			icon_pos = (256.0, 0.0)
		}
	}
	{
		green = {
			gem_material = mat_gem_green
			gem_hammer_material = mat_gem_hammer_green
			star_material = mat_star_green
			star_hammer_material = mat_star_hammer_green
			whammy_material = mat_whammy_green
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_green
			solo_star_material = mat_solo_star_green
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_green
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_green
			star_material_drum = mat_drum_star_green
			star_power_material_drum = mat_drum_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_drum_accent_green
			star_material_drum_accent = mat_drum_star_accent_green
			star_power_material_drum_accent = mat_drum_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_g
			icon_pos = (130.0, 100.0)
		}
		red = {
			gem_material = mat_gem_red
			gem_hammer_material = mat_gem_hammer_red
			star_material = mat_star_red
			star_hammer_material = mat_star_hammer_red
			whammy_material = mat_whammy_red
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_red
			solo_star_material = mat_solo_star_red
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_red
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_red
			star_material_drum = mat_drum_star_red
			star_power_material_drum = mat_drum_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_drum_accent_red
			star_material_drum_accent = mat_drum_star_accent_red
			star_power_material_drum_accent = mat_drum_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_r
			icon_pos = (130.0, 100.0)
		}
		yellow = {
			gem_material = mat_gem_yellow
			gem_hammer_material = mat_gem_hammer_yellow
			star_material = mat_star_yellow
			star_hammer_material = mat_star_hammer_yellow
			whammy_material = mat_whammy_yellow
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_yellow
			solo_star_material = mat_solo_star_yellow
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_yellow
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_cym_yellow
			star_material_drum = mat_drum_star_yellow
			star_power_material_drum = mat_cym_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_cym_accent_yellow
			star_material_drum_accent = mat_drum_star_accent_yellow
			star_power_material_drum_accent = mat_cym_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_y
			icon_pos = (130.0, 100.0)
		}
		blue = {
			gem_material = mat_gem_blue
			gem_hammer_material = mat_gem_hammer_blue
			star_material = mat_star_blue
			star_hammer_material = mat_star_hammer_blue
			whammy_material = mat_whammy_blue
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_blue
			solo_star_material = mat_solo_star_blue
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_blue
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_blue
			star_material_drum = mat_drum_star_blue
			star_power_material_drum = mat_drum_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_drum_accent_blue
			star_material_drum_accent = mat_drum_star_accent_blue
			star_power_material_drum_accent = mat_drum_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_b
			icon_pos = (130.0, 100.0)
		}
		orange = {
			gem_material = mat_gem_orange
			gem_hammer_material = mat_gem_hammer_orange
			star_material = mat_star_orange
			star_hammer_material = mat_star_hammer_orange
			whammy_material = mat_whammy_orange
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_orange
			solo_star_material = mat_solo_star_orange
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_orange
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_cym_orange
			star_material_drum = mat_drum_star_orange
			star_power_material_drum = mat_cym_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_cym_accent_orange
			star_material_drum_accent = mat_drum_star_accent_orange
			star_power_material_drum_accent = mat_cym_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_o
			icon_pos = (130.0, 100.0)
		}
		white = {
			gem_material = mat_open_note
			gem_hammer_material = mat_open_note_hammer
			star_material = mat_open_note_star
			star_hammer_material = mat_open_note_star_hammer
			whammy_material = mat_placeholder
			star_power_material = mat_open_note_star_power
			star_power_star_material = mat_open_note_star_power_star
			star_power_hammer_star_material = mat_open_note_star_power_star_hammer
			star_power_hammer_material = mat_open_note_star_power_hammer
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_placeholder
			solo_star_material = mat_placeholder
			solo_star_power_material = mat_placeholder
			solo_star_power_star_material = mat_placeholder
			solo_whammy_material = mat_placeholder
			solo_whammy_star_material = mat_placeholder
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_kickdrum
			star_material_drum = mat_drum_kickdrum_star
			star_power_material_drum = mat_drum_kickdrum_star_power
			star_power_star_material_drum = mat_drum_kickdrum_star_power_star
			gem_material_beginner = mat_kid_gem
			star_material_beginner = mat_kid_gem_star
			star_power_material_beginner = mat_kid_gem_star_power
			Name = button_b
			icon_pos = (256.0, 0.0)
		}
	}
	{
		green = {
			gem_material = mat_gem_green
			gem_hammer_material = mat_gem_hammer_green
			star_material = mat_star_green
			star_hammer_material = mat_star_hammer_green
			whammy_material = mat_whammy_green
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_green
			solo_star_material = mat_solo_star_green
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_green
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_green
			star_material_drum = mat_drum_star_green
			star_power_material_drum = mat_drum_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_drum_accent_green
			star_material_drum_accent = mat_drum_star_accent_green
			star_power_material_drum_accent = mat_drum_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_g
			icon_pos = (130.0, 100.0)
		}
		red = {
			gem_material = mat_gem_red
			gem_hammer_material = mat_gem_hammer_red
			star_material = mat_star_red
			star_hammer_material = mat_star_hammer_red
			whammy_material = mat_whammy_red
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_red
			solo_star_material = mat_solo_star_red
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_red
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_red
			star_material_drum = mat_drum_star_red
			star_power_material_drum = mat_drum_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_drum_accent_red
			star_material_drum_accent = mat_drum_star_accent_red
			star_power_material_drum_accent = mat_drum_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_r
			icon_pos = (130.0, 100.0)
		}
		yellow = {
			gem_material = mat_gem_yellow
			gem_hammer_material = mat_gem_hammer_yellow
			star_material = mat_star_yellow
			star_hammer_material = mat_star_hammer_yellow
			whammy_material = mat_whammy_yellow
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_yellow
			solo_star_material = mat_solo_star_yellow
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_yellow
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_cym_yellow
			star_material_drum = mat_drum_star_yellow
			star_power_material_drum = mat_cym_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_cym_accent_yellow
			star_material_drum_accent = mat_drum_star_accent_yellow
			star_power_material_drum_accent = mat_cym_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_y
			icon_pos = (130.0, 100.0)
		}
		blue = {
			gem_material = mat_gem_blue
			gem_hammer_material = mat_gem_hammer_blue
			star_material = mat_star_blue
			star_hammer_material = mat_star_hammer_blue
			whammy_material = mat_whammy_blue
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_blue
			solo_star_material = mat_solo_star_blue
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_blue
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_blue
			star_material_drum = mat_drum_star_blue
			star_power_material_drum = mat_drum_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_drum_accent_blue
			star_material_drum_accent = mat_drum_star_accent_blue
			star_power_material_drum_accent = mat_drum_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_b
			icon_pos = (130.0, 100.0)
		}
		orange = {
			gem_material = mat_gem_orange
			gem_hammer_material = mat_gem_hammer_orange
			star_material = mat_star_orange
			star_hammer_material = mat_star_hammer_orange
			whammy_material = mat_whammy_orange
			star_power_material = mat_gem_star
			star_power_star_material = mat_star_star
			star_power_hammer_star_material = mat_star_hammer_star
			star_power_hammer_material = mat_gem_hammer_star
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_solo_gem_orange
			solo_star_material = mat_solo_star_orange
			solo_star_power_material = mat_solo_gem_star
			solo_star_power_star_material = mat_solo_star_star
			solo_whammy_material = mat_solo_whammy_orange
			solo_whammy_star_material = mat_solo_whammy_star
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_cym_orange
			star_material_drum = mat_drum_star_orange
			star_power_material_drum = mat_cym_star
			star_power_star_material_drum = mat_drum_star_star
			gem_material_drum_accent = mat_cym_accent_orange
			star_material_drum_accent = mat_drum_star_accent_orange
			star_power_material_drum_accent = mat_cym_accent_star
			star_power_star_material_drum_accent = mat_drum_star_accent_star
			Name = button_o
			icon_pos = (130.0, 100.0)
		}
		white = {
			gem_material = mat_open_note
			gem_hammer_material = mat_open_note_hammer
			star_material = mat_open_note_star
			star_hammer_material = mat_open_note_star_hammer
			whammy_material = mat_placeholder
			star_power_material = mat_open_note_star_power
			star_power_star_material = mat_open_note_star_power_star
			star_power_hammer_star_material = mat_open_note_star_power_star_hammer
			star_power_hammer_material = mat_open_note_star_power_hammer
			star_power_whammy_material = mat_whammy_star
			solo_material = mat_placeholder
			solo_star_material = mat_placeholder
			solo_star_power_material = mat_placeholder
			solo_star_power_star_material = mat_placeholder
			solo_whammy_material = mat_placeholder
			solo_whammy_star_material = mat_placeholder
			gray_material = mat_placeholder
			gray_hammer_material = mat_placeholder
			gray_whammy_material = mat_whammy_star
			dead_whammy = mat_whammy_dead
			gem_material_drum = mat_drum_kickdrum
			star_material_drum = mat_drum_kickdrum_star
			star_power_material_drum = mat_drum_kickdrum_star_power
			star_power_star_material_drum = mat_drum_kickdrum_star_power_star
			gem_material_beginner = mat_kid_gem
			star_material_beginner = mat_kid_gem_star
			star_power_material_beginner = mat_kid_gem_star_power
			Name = button_b
			icon_pos = (256.0, 0.0)
		}
	}
]

script setup_models 
	tod_manager_create_perm_lights
	LightShow_CreatePermModels
endscript

script get_notetrack_part_text 
	if NOT GotParam \{part}
		if GotParam \{player_status}
			part = ($<player_status>.part)
		else
			getplayerinfo <Player> part
		endif
	endif
	if (<part> = bass)
		<part> = 'rhythm_'
	elseif (<part> = rhythm)

	elseif (<part> = drum)
		<part> = 'drum_'
	else
		if GotParam \{fullname}
			<part> = 'guitar'
		else
			<part> = ''
		endif
	endif
	if GotParam \{player_status}
		if ($game_mode = gh4_p2_career || $game_mode = p2_coop || $game_mode = p2_quickplay || $force_coop = 1 ||
				($game_mode = practice && ($<player_status>.part = bass)))
			get_song_struct song = <song_name>
			if StructureContains structure = <song_struct> use_coop_notetracks
				if (($<player_status>.part) = bass)
					<part> = 'rhythmcoop_'
				elseif (($<player_status>.part) = guitar)
					<part> = 'guitarcoop_'
				endif
			endif
		endif
	endif
	return part = <part>
endscript

script get_gem_array_name 

	get_notetrack_part_text Player = <Player> song_name = <song_name> part = <part>
	get_song_prefix song = <song_name>
	get_difficulty_text_nl difficulty = <difficulty> no_rhythm
	if (<song_name> = jamsession)
		blank_part = <part>
		<vocals> = 0
		if GotParam \{Player}
			getplayerinfo <Player> part
			if checksumequals a = <part> b = vocals
				<vocals> = 1
			endif
		endif
		if (<vocals> = 1)
			formatText \{checksumName = gem_array
				'jamsession_song_vocals'
				AddToStringLookup = true}
			<part> = <blank_part>
		else
			<part> = <blank_part>
			formatText checksumName = gem_array '%s_song_%p%d' s = <song_prefix> p = <part> d = <difficulty_text_nl> AddToStringLookup = true
		endif
	else
		formatText checksumName = gem_array '%s_song_%p%d' s = <song_prefix> p = <part> d = <difficulty_text_nl> AddToStringLookup = true
	endif
	return gem_array = <gem_array>
endscript

script get_fretbar_array_name 

	get_song_prefix song = <song_name>
	formatText checksumName = fretbar_array '%s_fretbars' s = <song_prefix> AddToStringLookup = true
	return fretbar_array = <fretbar_array>
endscript

script get_timsig_array_name 

	get_song_prefix song = <song_name>
	formatText checksumName = timesig_array '%s_timesig' s = <song_prefix> AddToStringLookup = true
	return timesig_array = <timesig_array>
endscript

script get_starpower_array_name 

	get_song_prefix song = <song_name>
	if (<part> = vocals)
		formatText checksumName = star_array '%s_vocals_Star' s = <song_prefix> p = <part> AddToStringLookup = true
	else
		get_notetrack_part_text Player = <Player> song_name = <song_name> part = <part>
		get_difficulty_text_nl difficulty = <difficulty> no_rhythm
		formatText checksumName = star_array '%s_%p%d_Star' s = <song_prefix> p = <part> d = <difficulty_text_nl> AddToStringLookup = true
	endif
	return star_array = <star_array>
endscript

script get_tapping_array_name 

	get_notetrack_part_text Player = <Player> song_name = <song_name> part = <part>
	get_song_prefix song = <song_name>
	get_difficulty_text_nl difficulty = <difficulty> no_rhythm
	formatText checksumName = tapping_array '%s_%p%d_Tapping' s = <song_prefix> p = <part> d = <difficulty_text_nl> AddToStringLookup = true
	return tapping_array = <tapping_array>
endscript

script get_drum_fill_array_name 

	get_song_prefix song = <song_name>
	get_difficulty_text_nl difficulty = <difficulty> no_rhythm
	formatText checksumName = drumfill_array '%s_%d_DrumFill' s = <song_prefix> d = <difficulty_text_nl> AddToStringLookup = true
	return drumfill_array = <drumfill_array>
endscript

script get_marker_array_name 

	get_notetrack_part_text Player = <Player> song_name = <song_name> part = <part> fullname
	get_song_prefix song = <song_name>
	formatText checksumName = marker_array '%s_%p_Markers' s = <song_prefix> p = <part> AddToStringLookup = true
	return marker_array = <marker_array>
endscript

script get_band_moment_array_name 

	get_song_prefix song = <song_name>
	formatText checksumName = band_moment_array '%s_BandMoment' s = <song_prefix> AddToStringLookup = true
	return band_moment_array = <band_moment_array>
endscript

script setup_gemarrays \{Player = 1}
	get_song_struct song = <song_name>
	get_notetrack_part_text player_status = <player_status> song_name = <song_name>
	get_song_prefix song = <song_name>
	get_difficulty_text_nl difficulty = <difficulty> no_rhythm
	if ($current_song = jamsession)
		blank_part = <part>
		<vocals> = 0
		getplayerinfo <Player> part
		if checksumequals a = <part> b = vocals
			<vocals> = 1
		endif
		if (<vocals> = 1)
			formatText \{checksumName = gem_array
				'jamsession_song_vocals'
				AddToStringLookup = true}
			<part> = <blank_part>
		else
			<part> = <blank_part>
			formatText checksumName = gem_array '%s_song_%p%d' s = <song_prefix> p = <part> d = <difficulty_text_nl> AddToStringLookup = true
		endif
	else
		formatText checksumName = gem_array '%s_song_%p%d' s = <song_prefix> p = <part> d = <difficulty_text_nl> AddToStringLookup = true
	endif
	formatText checksumName = fretbar_array '%s_fretbars' s = <song_prefix> AddToStringLookup = true
	Change structurename = <player_status> current_song_gem_array = <gem_array>
	setplayerinfo <Player> current_song_name = ($current_song)
	reset_tapping_array song_name = <song_name> difficulty = <difficulty> player_status = <player_status>
	return gem_array = <gem_array> fretbar_array = <fretbar_array> song_prefix = <song_prefix> part = <part> difficulty_text_nl = <difficulty_text_nl>
endscript

script calc_health_invincible_time 
	get_song_end_time song = ($current_song)
	health_invincible_time = 0.0
	0xcbfa64e8 = (<total_end_time> * $health_invincible_time_percentage_beginner / 100.0)
	time_easy = (<total_end_time> * $health_invincible_time_percentage_easy / 100.0)
	time_medium = (<total_end_time> * $health_invincible_time_percentage_medium / 100.0)
	if ($game_mode = p1_quickplay || $game_mode = gh4_p1_career)
		Player = ($<player_status>.Player)
		getplayerinfo <Player> difficulty
		switch <difficulty>
			case beginner
			health_invincible_time = <0xcbfa64e8>
			case easy
			health_invincible_time = <time_easy>
			case medium
			health_invincible_time = <time_medium>
		endswitch
	else
		get_highest_difficulty_num \{num_players = $current_num_players}
		if GotParam \{highest_difficulty_num}
			switch <highest_difficulty_num>
				case 0
				health_invincible_time = <0xcbfa64e8>
				case 1
				health_invincible_time = <time_easy>
				case 2
				health_invincible_time = <time_medium>
			endswitch
		endif
	endif
	Change structurename = <player_status> health_invincible_time = <health_invincible_time>
endscript

script get_highest_difficulty_num \{num_players = 4}
	i = 1
	max_diff_num = 0
	begin
	getplayerinfo <i> difficulty
	switch <difficulty>
		case beginner
		diff_num = 0
		case easy
		diff_num = 1
		case medium
		diff_num = 2
		case hard
		diff_num = 3
		case expert
		diff_num = 4
	endswitch
	if (<diff_num> > <max_diff_num>)
		max_diff_num = <diff_num>
	endif
	i = (<i> + 1)
	repeat <num_players>
	return highest_difficulty_num = <max_diff_num>
endscript

script gem_scroller \{Player = 1
		training_mode = 0}
	check_song_for_zero_difficulty song = <song_name> Player = <Player> part = ($<player_status>.part)
	setup_gemarrays song_name = <song_name> difficulty = <difficulty> player_status = <player_status> Player = <Player>
	calc_health_invincible_time song = <song_name> player_status = <player_status>
	if (($<player_status>.part) = drum)
		Change structurename = <player_status> check_time_early = ($drum_time_early * $current_speedfactor)
		Change structurename = <player_status> check_time_late = ($drum_time_late * $current_speedfactor)
	else
		Change structurename = <player_status> check_time_early = ($check_time_early * $current_speedfactor)
		Change structurename = <player_status> check_time_late = ($check_time_late * $current_speedfactor)
	endif
	formatText checksumName = input_array 'input_array%p' p = <player_text>











	InputArrayCreate Name = <input_array>
	<gem_offset> = ($time_gem_offset * $current_speedfactor)
	<input_offset> = ($time_input_offset * $current_speedfactor)
	GetGlobalTags \{user_options
		attract_mode_fix = 1}
	if (<lag_calibration> > 999)
		Mod a = <lag_calibration> b = 1000
		<video_offset> = (0 - <Mod>)
		<audio_offset> = ((<lag_calibration> / 1000) - 1)
		<input_offset> = (<input_offset> - <audio_offset>)
		<gem_offset> = (<gem_offset> - <audio_offset>)
		<gem_offset> = (<gem_offset> - <video_offset>)
		Change time_drum_midi_offset_with_lag = ($time_drum_midi_offset + <audio_offset> + <video_offset>)
		Change time_gem_offset_with_lag = ($time_gem_offset - <audio_offset> - <video_offset>)
	else
		<input_offset> = (<input_offset> - <lag_calibration>)
		Change \{time_drum_midi_offset_with_lag = $time_drum_midi_offset}
		Change \{time_gem_offset_with_lag = $time_gem_offset}
	endif
	if ((<training_mode> = 1) || ($game_mode = practice))
		SpawnScriptLater tempo_matching_iterator params = {song_name = <song_name> difficulty = <difficulty> thin_fretbars
			time_offset = <gem_offset> fretbar_function = create_fretbar skipleadin = 0
			Player = <Player> player_status = <player_status> player_text = <player_text>}
	else
		if (<Player> = 1)
			bandmanager_startallanimiterators song_name = <song_name> time_offset = <gem_offset>
			if ($drumtest = 1)
				KillSpawnedScript \{Name = drummer_controlscript}
				SpawnScriptNow \{drummer_controlscript}
			endif
			SpawnScriptLater WatchForStartPlaying_iterator params = {time_offset = <gem_offset>}
			SpawnScriptLater tempo_matching_iterator params = {song_name = <song_name> difficulty = <difficulty> thin_fretbars
				time_offset = <gem_offset> fretbar_function = create_fretbar skipleadin = 0
				Player = <Player> player_status = <player_status> player_text = <player_text>}
			SpawnScriptLater drumkit_anim_iterator params = {
				id = drummer
				song_name = <song_name> difficulty = <difficulty>
				time_offset = <gem_offset>
				skipleadin = 0
				Player = <Player>
				player_status = <player_status>
				player_text = <player_text>
			}
		elseif (($<player_status>.part) = drum)
			id = ($<player_status>.band_member)
			if NOT (<id> = drummer)
				SpawnScriptLater drumkit_anim_iterator params = {
					id = <id>
					song_name = <song_name> difficulty = <difficulty>
					time_offset = <gem_offset>
					skipleadin = 0
					Player = <Player>
					player_status = <player_status>
					player_text = <player_text>
				}
			endif
		endif
	endif
	fill_input_offset = ((($<player_status>.scroll_time - $destroy_time) * 1000.0) + <gem_offset> + 1000.0)
	formatText checksumName = input_array 'input_array%p' p = <player_text>
	SpawnScriptLater gem_iterator params = {iterator_text = 'fill_array' song_name = <song_name> difficulty = <difficulty> part = <part> input_array = <input_array>
		time_offset = <fill_input_offset> strum_function = fill_input_array skipleadin = ($<player_status>.scroll_time * 1000.0)
		Player = <Player> player_status = <player_status> player_text = <player_text>}
	<do_bot> = 0
	if (($<player_status>.bot_play = 1) || ($<player_status>.is_local_client = 0))
		<do_bot> = 1
	endif
	if (<do_bot> = 1)
		formatText checksumName = botresponse_array 'botresponse_array%p' p = <player_text>
		InputArrayCreate Name = <botresponse_array>
		SpawnScriptLater gem_iterator params = {iterator_text = 'fill_botresponsearray' song_name = <song_name> difficulty = <difficulty> part = <part> input_array = <botresponse_array>
			time_offset = ((($<player_status>.scroll_time - $destroy_time) * 1000.0) + <gem_offset> + 1000.0) strum_function = fill_input_array skipleadin = ($<player_status>.scroll_time * 1000.0)
			Player = <Player> player_status = <player_status> player_text = <player_text>}
		SpawnScriptLater gem_iterator params = {iterator_text = 'bot' song_name = <song_name> difficulty = <difficulty> part = <part> use_input_array = 'botresponse_array'
			time_offset = ((($<player_status>.check_time_early) * 1000.0) + <input_offset> - ($check_time_late * 1000.0)) strum_function = check_buttons_bot skipleadin = ($<player_status>.scroll_time * 1000.0)
			Player = <Player> player_status = <player_status> player_text = <player_text>}

	endif
	SpawnScriptLater gem_iterator params = {iterator_text = 'create_gem' song_name = <song_name> difficulty = <difficulty> part = <part> use_input_array = 'input_array'
		time_offset = ((($<player_status>.scroll_time - $destroy_time) * 1000.0) + <gem_offset>) gem_function = create_gem skipleadin = ($<player_status>.scroll_time * 1000.0)
		Player = <Player> player_status = <player_status> player_text = <player_text>}
	get_song_prefix song = <song_name>
	formatText checksumName = guitar_stream '%s_guitar' s = <song_prefix> AddToStringLookup
	if GotParam \{looping}
		restartplayerserverinput {
			id = <player_status>
			Player = <Player>
			controller = ($<player_status>.controller)
			difficulty = <difficulty>
			guitar_stream = <guitar_stream>
			time_offset = ((($<player_status>.check_time_early) * 1000.0) + <input_offset>)
			song_name = <song_name>
		}
	else
		createplayerserver id = <player_status> Player = <Player>
		addplayerserverinput {id = <player_status>
			Player = <Player>
			controller = ($<player_status>.controller)
			difficulty = <difficulty>
			guitar_stream = <guitar_stream>
			time_offset = ((($<player_status>.check_time_early) * 1000.0) + <input_offset>)
			song_name = <song_name>
		}
		addplayerserverhighway id = <player_status> Player = <Player>
	endif
	if NOT playerinfoequals <Player> part = vocals
		addplayerserverfretbariterator {fretbar_id = createfretbar id = <player_status> song_name = <song_name> difficulty = <difficulty> thin_fretbars
			time_offset = ((($<player_status>.scroll_time - $destroy_time) * 1000.0) + <gem_offset>) fretbar_function = Create2DFretbar skipleadin = ($<player_status>.scroll_time * 1000.0)
			Player = <Player> player_status = <player_status> player_text = <player_text>}
	endif
	SpawnScriptLater fretbar_update_tempo params = {song_name = <song_name> difficulty = <difficulty>
		time_offset = ((($<player_status>.check_time_early) * 1000.0) + <gem_offset>) Player = <Player> skipleadin = ($<player_status>.scroll_time * 1000.0)
		player_status = <player_status> player_text = <player_text>}
	SpawnScriptLater fretbar_update_hammer_on_tolerance params = {song_name = <song_name> difficulty = <difficulty>
		time_offset = ((($<player_status>.scroll_time - $destroy_time) * 1000.0) + <gem_offset> + 1000.0) Player = <Player> skipleadin = ($<player_status>.scroll_time * 1000.0)
		player_status = <player_status> player_text = <player_text>}
	if (<Player> = 1)
		addplayerserverfretbariterator {fretbar_id = prefretbarevent id = <player_status> song_name = <song_name> difficulty = <difficulty>
			time_offset = (($prefretbar_time * 1000.0) + <gem_offset>) fretbar_function = GuitarEvent_PreFretbar skipleadin = 0
			Player = <Player> player_status = <player_status> player_text = <player_text>}
		addplayerserverfretbariterator {fretbar_id = fretbarevent id = <player_status> song_name = <song_name> difficulty = <difficulty>
			time_offset = <gem_offset> fretbar_function = GuitarEvent_Fretbar skipleadin = 0
			Player = <Player> player_status = <player_status> player_text = <player_text>}
		if ($Debug_Audible_Downbeat = 1)
			addplayerserverfretbariterator {fretbar_id = fretbareventearly id = <player_status> song_name = <song_name> difficulty = <difficulty>
				time_offset = (<gem_offset> + ($check_time_early * 1000.0)) fretbar_function = GuitarEvent_Fretbar_Early skipleadin = 0
				Player = <Player> player_status = <player_status> player_text = <player_text>}
			addplayerserverfretbariterator {fretbar_id = fretbareventlate id = <player_status> song_name = <song_name> difficulty = <difficulty>
				time_offset = (<gem_offset> - ($check_time_late * 1000.0)) fretbar_function = GuitarEvent_Fretbar_Late skipleadin = 0
				Player = <Player> player_status = <player_status> player_text = <player_text>}
		endif
		if GotParam \{looping}
			return
		endif
		if NOT 0x2e51d96c
			SpawnScriptNow lightshow_iterator params = {song_name = <song_name> time_offset = (<gem_offset> + $lightshow_offset_ms) skipleadin = 0}
			SpawnScriptLater cameracuts_iterator params = {song_name = <song_name> time_offset = <gem_offset> skipleadin = 0}
		endif
		GetArraySize \{$scripts_array}
		array_count = 0
		begin
		<lead_ms> = ($scripts_array [<array_count>].lead_ms)
		SpawnScriptLater event_iterator params = {song_name = <song_name> difficulty = <difficulty>
			event_string = ($scripts_array [<array_count>].Name) time_offset = (<gem_offset> + <lead_ms>) skipleadin = 0
			Player = <Player> player_status = <player_status> player_text = <player_text>}
		SpawnScriptLater notemap_startiterator params = {song_name = <song_name> difficulty = <difficulty>
			event_string = ($scripts_array [<array_count>].Name) time_offset = (<gem_offset> + <lead_ms>) skipleadin = 0
			Player = <Player> player_status = <player_status> player_text = <player_text>}
		array_count = (<array_count> + 1)
		repeat <array_Size>
	endif
	SpawnScriptLater win_song params = {<...>}
endscript

script get_song_end_time_for_array 
	if NOT GlobalExists Name = <song_array>
		total_end_time2 = 2.0
	else
		GetArraySize $<song_array>
		if (<array_Size> = 0)
			total_end_time2 = 2.0
		else
			last_entry = (<array_Size> - $num_song_columns)
			end_time = ($<song_array> [(<last_entry>)])
			<whammy_time> = ($<song_array> [(<last_entry> + 1)])
			whammy_time = (<whammy_time> - ((<whammy_time> / 65536) * 65536))
			total_end_time2 = (<end_time> + <whammy_time>)
		endif
	endif
	if NOT GotParam \{total_end_time}
		total_end_time = <total_end_time2>
	else
		if (<total_end_time2> > <total_end_time>)
			total_end_time = <total_end_time2>
		endif
	endif
	return total_end_time = <total_end_time>
endscript

script get_song_end_time \{for_practice = 0}
	songfilemanager func = get_song_end_time song_name = <song>
	return total_end_time = <total_end_time>
endscript
failed_song = 0

script win_song 
	Change \{failed_song = 0}
	getfirstplayer \{out = first_player}
	if (<Player> = <first_player>)
		Change \{num_players_finished = 0}
	endif
	songfilemanager func = get_song_end_time song_name = <song_name>

	TimeMarkerReached_SetParams time_offset = 0 time = <total_end_time>
	begin
	if TimeMarkerReached
		break
	endif
	Wait \{1
		gameframe}
	repeat
	getnumplayersingame
	if (<num_players> = 2)
		wait_on_player = 2
	else
		wait_on_player = 1
	endif

	Wait \{$Song_Win_Delay
		Seconds}
	Change num_players_finished = ($num_players_finished + 1)

	gamemode_getnumplayersshown
	if ($num_players_finished >= <num_players_shown>)

		ExtendCrc song_won <player_text> out = Type
		broadcastevent Type = <Type> data = {song_complete = 1}
	endif
endscript
last_gems = None
last_fx_set = None
last_star_set = None
0x7789be5d = None

script unload_gempaks 
	if ($last_gems != None)

		UnLoadPak \{$last_gems}
	endif
	if ($last_fx_set != None)

		formatText \{TextName = fxpak
			'%i.pak'
			i = $last_fx_set
			AddToStringLookup = true}
		UnLoadPak <fxpak>
	endif
	if ($last_star_set != None)

		formatText \{TextName = starpak
			'%i.pak'
			i = $last_star_set
			AddToStringLookup = true}
		UnLoadPak <starpak>
	endif
endscript

script 0x136c76bb 
	<pak> = $0x7789be5d
	if (<pak> != None)
		if StructureContains structure = $ghzones <pak>
			zone_name = ($ghzones.<pak>.Name)
		elseif StructureContains structure = $0x94a64133 <pak>
			zone_name = ($0x94a64133.<pak>.Name)
		else
			return
		endif


		formatText TextName = 0x0ba45610 'pak/anims/zones/%s_anims.pak' s = (<zone_name>)

		UnLoadPak <0x0ba45610>
		Change \{0x7789be5d = None}
	endif
endscript

script 0x3d141c93 
	GetPakManCurrent \{map = zones}
	if (<pak> != $0x7789be5d)
		0x136c76bb
		if StructureContains structure = $ghzones <pak>
			zone_name = ($ghzones.<pak>.Name)
		elseif StructureContains structure = $0x94a64133 <pak>
			zone_name = ($0x94a64133.<pak>.Name)
		else
			return
		endif


		formatText TextName = 0x0ba45610 'pak/anims/zones/%s_anims.pak' s = (<zone_name>)

		LoadPak <0x0ba45610> no_assert
		Change 0x7789be5d = <pak>
	endif
endscript

script load_gempaks \{async = 0}
	GetGlobalTags \{user_options
		attract_mode_fix = 1}
	if NOT GotParam \{gem_set}
		gem_set = standard_gems
	endif
	if NOT GotParam \{fx_set}
		fx_set = standard_fx
	endif
	if NOT GotParam \{star_set}
		star_set = standard_stars
	endif
	unload_gempaks
	if NOT lookupgemstring Name = <gem_set>
		pak = 'pak/gems/standard_gems'
	endif

	formatText TextName = gempak '%i.pak' i = <pak> AddToStringLookup = true

	LoadPakAsync pak_name = <gempak> Heap = heap_cas no_vram async = <async>
	Change last_gems = <gempak>
	if NOT lookupgemstring Name = <fx_set>
		pak = 'pak/gems/standard_fx'
	endif
	formatText TextName = fxpak '%i.pak' i = <pak> AddToStringLookup = true

	LoadPakAsync pak_name = <fxpak> Heap = heap_cas no_vram async = <async>
	Change last_fx_set = <pak>
	if NOT lookupgemstring Name = <star_set>
		pak = 'pak/gems/standard_star'
	endif
	formatText TextName = starpak '%i.pak' i = <pak> AddToStringLookup = true

	LoadPakAsync pak_name = <starpak> Heap = heap_cas no_vram async = <async>
	Change last_star_set = <pak>
endscript

script load_song_anims \{async = 0}
	get_song_performance song = <song_name>
	if (<song_name> = jamsession)
	else
		if (<song_performance> = 0)
			song_perf_ext = ''
		else
			formatText TextName = song_perf_ext '_perf%i' i = (<song_performance> + 1)
		endif
		get_song_prefix song = <song_name>
		formatText TextName = animqpak 'pak/anims/songs/%i%s_anims.pak' i = <song_prefix> s = <song_perf_ext> AddToStringLookup = true

		if NOT LoadPakAsync pak_name = <animqpak> Heap = heap_song no_vram async = <async>
			DownloadContentLost
			return
		endif
	endif
endscript

script unload_song_anims 
	if ($current_song_qpak = None)
		return
	endif
	if ($current_song_qpak = jamsession)
	else
		if ($current_song_qpak_performance = 0)
			song_perf_ext = ''
		else
			formatText TextName = song_perf_ext '_perf%i' i = ($current_song_qpak_performance + 1)
		endif
		get_song_prefix song = ($current_song_qpak)
		formatText TextName = songqpak 'pak/anims/songs/%i%s_anims.pak' i = <song_prefix> s = <song_perf_ext> AddToStringLookup = true

		UnLoadPak <songqpak>
	endif
endscript

script load_songqpak \{async = 0}




	get_song_performance song = <song_name>
	if NOT (<song_name> = $current_song_qpak &&
			<song_performance> = $current_song_qpak_performance)
		Transitions_ResetZone \{Profile = $profile_ven_camera_obj}
		unload_songqpak
		if (<song_name> = jamsession)
		else
			if (<song_performance> = 0)
				song_perf_ext = ''
			else
				formatText TextName = song_perf_ext '_perf%i' i = (<song_performance> + 1)
			endif
			get_song_prefix song = <song_name>
			formatText TextName = songqpak 'songs/%i%s.pak' i = <song_prefix> s = <song_perf_ext> AddToStringLookup = true

			if NOT LoadPakAsync pak_name = <songqpak> Heap = heap_song no_vram async = <async>
				DownloadContentLost
				return
			endif
		endif
		Change current_song_qpak = <song_name>
		Change current_song_qpak_performance = <song_performance>
		if GotParam \{song_prefix}
			formatText checksumName = song_setup '%s_setup' s = <song_prefix>
			if ScriptExists <song_setup>
				SpawnScriptNow <song_setup>
			endif
		endif
		if NOT songfilemanager \{func = 0xc7c46bb1
				song_name = $current_song}
			Change \{0x37e424bf = true}
			songfilemanager \{func = add_song_file
				song_name = $current_song}
		else
			Change \{0x37e424bf = FALSE}
		endif
	endif
endscript

script unload_songqpak 
	if NOT ($current_song_qpak = None)
		if ($0x37e424bf = true)
			songfilemanager \{func = remove_song_file
				song_name = $current_song}
		endif
		if ($current_song_qpak = jamsession)
			if ($0xdd4f68fd = 0)
				jamsession_unload \{song_prefix = 'jamsession'}
				clearjamsession
			endif
		else
			if ($current_song_qpak_performance = 0)
				song_perf_ext = ''
			else
				formatText TextName = song_perf_ext '_perf%i' i = ($current_song_qpak_performance + 1)
			endif
			get_song_prefix song = ($current_song_qpak)
			unload_song_anims
			formatText TextName = songqpak 'songs/%i%s.pak' i = <song_prefix> s = <song_perf_ext> AddToStringLookup = true

			UnLoadPak <songqpak>
		endif
		Change \{current_song_qpak = None}
		Change \{current_song_qpak_performance = 0}
	endif
endscript

script unpause_loading_scripts 
	unpausespawnedscript \{crowd_loading_surge}
	unpausespawnedscript \{loading_screen_crowd_swell}
	unpausespawnedscript \{crowd_loading_whistle}
endscript
playing_song = 0
playing_song_for_real = 0

script start_gem_scroller \{starttime = 0
		practice_intro = 0
		training_mode = 0
		endtime = 99999999
		end_credits_restart = 0
		loading_transition = 0
		restarting = 0}
	if NOT GotParam \{0x97cb575b}
		0x9db2b00d
	endif
	0x3d141c93
	0x22a3ae8d
	Change \{0xa3ce893c = 0}
	update_all_volumes
	Change \{Star_power_verb_is_on = 0}
	<note_input> = $disable_note_input
	Change \{disable_note_input = 1}
	Change last_start_pressed_device = ($primary_controller)
	unpause_loading_scripts
	Change \{structurename = player1_status
		bot_pattern = 0}
	Change \{structurename = player2_status
		bot_pattern = 0}
	Change \{structurename = player3_status
		bot_pattern = 0}
	Change \{structurename = player4_status
		bot_pattern = 0}
	Change \{structurename = player1_status
		bot_strum = 0}
	Change \{structurename = player2_status
		bot_strum = 0}
	Change \{structurename = player3_status
		bot_strum = 0}
	Change \{structurename = player4_status
		bot_strum = 0}
	yield
	if (<end_credits_restart> = 1)

	else
		if NOT ($current_song = $final_credits_song)
			Change \{end_credits = 0}
		endif
	endif
	yield
	song_start_time = <starttime>
	yield \{'preload_song'}
	if (<loading_transition> = 0)
		Change \{playing_song = 1}
	endif
	if ($ps2_gameplay_restart_song = 0)
		unload_songqpak
		cas_destroy_all_characters
	endif
	mark_unsafe_for_shutdown
	yield
	dragonforce_hack_off
	tap_prototype_off
	menu_music_off
	yield
	song_quiet_reset_sfx_balance restarting = <restarting> loading_transition = <loading_transition>
	gh3_adjustcrowdloopbacktodefault restarting = <restarting>
	yield
	GuitarEvent_EnterVenue
	init_play_log
	yield
	Change \{structurename = guitarist_info
		stance = Stance_A}
	Change \{structurename = guitarist_info
		next_stance = Stance_A}
	Change \{structurename = guitarist_info
		current_anim = Idle}
	Change \{structurename = guitarist_info
		cycle_anim = true}
	Change \{structurename = guitarist_info
		next_anim = None}
	Change \{structurename = guitarist_info
		playing_missed_note = FALSE}
	Change \{structurename = guitarist_info
		waiting_for_cameracut = FALSE}
	yield
	Change \{structurename = bassist_info
		stance = Stance_A}
	Change \{structurename = bassist_info
		next_stance = Stance_A}
	Change \{structurename = bassist_info
		current_anim = Idle}
	Change \{structurename = bassist_info
		cycle_anim = true}
	Change \{structurename = bassist_info
		next_anim = None}
	Change \{structurename = bassist_info
		playing_missed_note = FALSE}
	Change \{structurename = bassist_info
		waiting_for_cameracut = FALSE}
	yield
	Change \{structurename = vocalist_info
		stance = Stance_A}
	Change \{structurename = vocalist_info
		next_stance = Stance_A}
	Change \{structurename = vocalist_info
		current_anim = Idle}
	Change \{structurename = vocalist_info
		cycle_anim = true}
	Change \{structurename = vocalist_info
		next_anim = None}
	yield
	Change \{structurename = drummer_info
		stance = Stance_A}
	Change \{structurename = drummer_info
		next_stance = Stance_A}
	Change \{structurename = drummer_info
		current_anim = Idle}
	Change \{structurename = drummer_info
		cycle_anim = true}
	Change \{structurename = drummer_info
		next_anim = None}
	Change \{structurename = drummer_info
		TWIST = 0.0}
	Change \{structurename = drummer_info
		desired_twist = 0.0}
	Change \{structurename = drummer_info
		last_left_arm_note = 0}
	Change \{structurename = drummer_info
		last_right_arm_note = 0}
	yield
	band_clearanimtempo
	yield
	if ($ps2_gameplay_restart_song = 0)
		0xce69e479
		unload_songqpak
		WaitOneGameFrame
		load_songqpak song_name = <song_name> async = 1
		ps2_load_car_part_script
	endif
	if (<loading_transition> = 0)
		Change \{0x19d65371 = 0}
		create_all_camera_lock_targets
		yield \{'create_all_camera_lock_targets'}
		if (<training_mode> = 0)
			yield
			if ($ps2_gameplay_restart_song = 0)
				band_unload_anim_paks
				band_unload_song_anim_paks
				smartflushpak \{async = 0
					tags = {
						map = animpak
					}}
				smartflushpak \{async = 0
					tags = {
						map = looppak
					}}
				if NOT create_band \{async = 1}
					DownloadContentLost
				endif
			endif
			yield \{'create_band2'}
		endif
		yield
		create_vocalist_dummy
		yield
		yield
	endif
	if ($ps2_gameplay_restart_song = 0)
		0xce69e479
	endif
	begin_singleplayer_game
	yield
	Change current_song = <song_name>
	begin
	if songfilemanager \{func = 0xc7c46bb1
			song_name = $current_song}
		break
	endif
	Wait \{1
		gameframe}
	repeat
	cache_song_end_time
	Change structurename = player1_status difficulty = <difficulty>
	Change structurename = player2_status difficulty = <difficulty2>
	Change current_starttime = <starttime>
	Change current_endtime = <endtime>
	Change \{showing_raise_axe = 0}
	in_the_round_check
	yield
	Progression_SetProgressionNodeFlags
	yield \{'Nodeflags'}
	if (($player2_status.bot_play = 1) || ($player2_status.is_local_client = 0))
		setup_bot_controller \{Player = 2}

	endif
	if ($player1_status.bot_play = 1)
		setup_bot_controller \{Player = 1}

	endif
	if (($player3_status.bot_play = 1) || ($player3_status.is_local_client = 0))
		setup_bot_controller \{Player = 3}

	endif
	if (($player4_status.bot_play = 1) || ($player4_status.is_local_client = 0))
		setup_bot_controller \{Player = 4}

	endif
	if ($ps2_gameplay_restart_song = 0)
		unload_gempaks
		<0x0347f72c> = ''
		if ($game_mode = p2_pro_faceoff)
			<0x0347f72c> = 'pak/oogame/oogamevs.pak'
		elseif ($game_mode = p2_quickplay || $game_mode = p3_quickplay || $game_mode = p4_quickplay ||
				$game_mode = gh4_p2_career || $game_mode = gh4_p3_career || $game_mode = gh4_p4_career ||
				$game_mode = p4_pro_faceoff || $game_mode = p6_pro_faceoff_no_mics || $game_mode = p8_pro_faceoff)
			<0x0347f72c> = 'pak/oogame/oogameband.pak'
		else
			<0x0347f72c> = 'pak/oogame/oogame.pak'
		endif
		if NOT ($0xa025a029 = <0x0347f72c>)
			if NOT ($0xa025a029 = '')
				UnLoadPak \{$0xa025a029
					Heap = heap_cas}
			endif
			Change 0xa025a029 = <0x0347f72c>
			if NOT ($0xa025a029 = '')
				LoadPak \{$0xa025a029
					Heap = heap_cas}
			endif
		endif
	endif
	if ($game_mode = tutorial)

	elseif ($game_mode = p2_pro_faceoff)
		0xc1c4e84c \{mode = 0x68721771}
	elseif ($current_song = jamsession)
		0xc1c4e84c \{mode = jammode}
	else
		0xc1c4e84c \{mode = 0xae92eddf}
	endif
	yield







	yield
	if (<song_name> = jamsession)
		getsonginfo
		drum_kit = 0
		setsonginfo \{drum_kit = 0}
		Change jam_current_drum_kit = <drum_kit>
		loaddrumkitall drum_kit = ($drum_kits [<drum_kit>].string_id) percussion_kit = ($drum_kits [<drum_kit>].percussion_string_id) async = 0
		melody_kit = 0
		setsonginfo \{melody_kit = 0}
		Change jam_current_melody_kit = <melody_kit>
		if GotParam \{bass_kit}
			GetArraySize \{$pause_bass_kit_options}
			if ((<bass_kit> >= <array_Size>) || (<bass_kit> < 0))
				<bass_kit> = 0
			endif
			Change bass_kit_mode = <bass_kit>
		else
			setsonginfo \{bass_kit = 0}
			Change \{bass_kit_mode = 0}
		endif
	else
		drum_kit_index = 0
		Change jam_current_drum_kit = <drum_kit_index>
		loaddrumkitall drum_kit = <drum_kit_type>
	endif
	yield \{'LoadDrumKitAll'}
	call_startup_scripts <...>
	yield
	if (<loading_transition> = 0)
		setup_bg_viewport
		if (<training_mode> = 0)
			KillCamAnim \{all}
		endif
		create_cameracuts <...>
	else
		reset_cameracuts_internal_vars
	endif
	yield \{'setup_bg_viewport2'}
	if 0x2e51d96c


		0x6797e24c <...>
	endif
	if NOT (<song_name> = jamsession)
		preload_song song_name = <song_name> starttime = <starttime>





		starttime = <adjustedtime>
		Change current_starttime = <starttime>
	endif
	starttimeafterintro = <starttime>

	if ($current_transition = None)
		Change \{current_transition = fastintro}
	endif
	GetGlobalTags \{user_options
		attract_mode_fix = 1}
	<transition_lag_offset> = 0
	if (<lag_calibration> > 999)
		Mod a = <lag_calibration> b = 1000
		<video_offset> = (0 - <Mod>)
		<audio_offset> = ((<lag_calibration> / 1000) - 1)
		<transition_lag_offset> = (0 - <video_offset> - <audio_offset>)
	endif
	yield
	Transition_GetTime Type = ($current_transition)
	starttime = (<starttime> - <transition_time> - <transition_lag_offset>)
	if (<loading_transition> = 0)
		yield
		setslomo \{0.001}
		reset_song_time starttime = <starttime>
	endif
	yield
	if NOT ($use_character_debug_cam = 1)
	endif
	yield
	if (<loading_transition> = 0)
		if (<training_mode> = 0)
			if NOT ($game_mode = practice)
				apply_band_logo_to_venue \{step = build}
			endif
		endif
		yield \{'apply_band_logo_to_venue'}
		if ((<training_mode> = 1) || ($game_mode = practice))
			if ($current_bandname_viewport = None)
				create_movie_viewport
			endif
		else
			create_movie_viewport
		endif
		yield
		create_crowd_models
	endif
	yield \{'create_crowd_models'}
	yield
	Crowd_Create_Lighters
	yield
	Crowd_StageDiver_Hide
	yield
	if ($debug_showmeasures = On)
		if ScreenElementExists \{id = debug_measures_text}
			debug_measures_text :se_setprops \{unhide}
			debug_measures_text :se_setprops \{text = qs(0x9f7db74f)}
		endif
	endif
	if ($debug_showsongtime = On)
		debug_songtime_text :se_setprops \{unhide}
	endif
	if ($debug_showsongstars = On)
		debug_songstars_text :se_setprops \{unhide
			text = qs(0xfbf320c8)}
	endif
	yield
	if ($ps2_gameplay_restart_song = 0)
		0xce69e479
		WaitOneGameFrame
		load_song_anims song_name = <song_name> async = 1
		0xf11ce60b
	endif
	if ($game_mode = practice)
		practicemode_init
	endif
	yield \{'preload_song'}
	Player = 1
	begin
	set_song_section_array Player = <Player>
	Player = (<Player> + 1)
	repeat $current_num_players
	yield
	calc_score = true
	yield
	if NOT ($end_credits = 1)
		if ($use_last_player_scores = 0)
			reset_score \{player_status = player1_status}
		else
			Change \{use_last_player_scores = 0}
			<calc_score> = FALSE
		endif
	endif
	reset_score \{player_status = player2_status}
	reset_score \{player_status = player3_status}
	reset_score \{player_status = player4_status}
	Change \{structurename = band1_status
		score = 0}
	Change \{structurename = band1_status
		star_power_amount = 0}
	Change \{structurename = band2_status
		score = 0}
	Change \{structurename = band2_status
		star_power_amount = 0}
	yield \{'reset_score'}
	GetGlobalTags \{user_options
		attract_mode_fix = 1}
	yield
	GetArraySize \{$currently_holding
		param = holding_size}
	holding_count = 0
	begin
	SetArrayElement ArrayName = currently_holding globalarray index = <holding_count> NewValue = 0
	holding_count = (<holding_count> + 1)
	repeat <holding_size>
	yield
	<num_players> = $current_num_players
	if (<num_players> > 0)
		Player = 1
		begin
		if (<Player> >= 2)
			getplayerinfo <Player> difficulty
		endif
		yield
		<player_status> = ($0x2994109a [<Player>])
		<player_text> = ($0x57e22f28 [<Player>])
		player_on_screen = 1
		if (gamemode_isbandbattle)
			if NOT (($<player_status>.team) = ($player1_status.team))
				player_on_screen = 0
			endif
		endif
		Change structurename = <player_status> guitar_volume = 100
		Change structurename = <player_status> drum_volume1 = 100
		Change structurename = <player_status> drum_volume2 = 100
		Change structurename = <player_status> drum_volume3 = 100
		Change structurename = <player_status> drum_volume4 = 100
		if (<player_on_screen> = 1)
			UpdateGuitarVolume
		endif
		yield
		GetGlobalTags \{user_options
			attract_mode_fix = 1}
		if ($is_network_game = 0)
			Change structurename = <player_status> lefthanded_gems = ($<player_status>.lefty_flip)
			Change structurename = <player_status> lefthanded_button_ups = ($<player_status>.lefty_flip)
		endif
		yield
		get_resting_whammy_position controller = ($<player_status>.controller)
		if GotParam \{resting_whammy_position}
			Change structurename = <player_status> resting_whammy_position = <resting_whammy_position>
		endif
		get_star_power_position controller = ($<player_status>.controller)
		if GotParam \{star_power_position}
			Change structurename = <player_status> star_tilt_threshold = <star_power_position>
		endif
		yield
		if (($tutorial_disable_hud = 0) && (<player_on_screen> = 1) && ($end_credits = 0))
			setup_hud <...>
		endif
		yield \{'setup_hud'}
		if ($output_gpu_log = 1)
			TextOutputStart
		endif
		yield
		if (($tutorial_disable_hud = 0) && ($end_credits = 0))
			crowd_reset <...>
		endif
		yield \{'crowd_reset'}
		star_power_reset <...>
		yield
		if (($<player_status>.part) = guitar)
			Change structurename = <player_status> Hyperspeed = <hyperspeed_guitar>
		elseif (($<player_status>.part) = bass)
			Change structurename = <player_status> Hyperspeed = <hyperspeed_bass>
		elseif (($<player_status>.part) = drum)
			Change structurename = <player_status> Hyperspeed = <hyperspeed_drum>
		else
			Change structurename = <player_status> Hyperspeed = 1.0
		endif
		if (<Player> = 1)
			load_gempaks
		endif
		yield
		difficulty_setup <...>
		yield
		if (<player_on_screen>)
			if (($<player_status>.part) != vocals)
				setup_highway <...>
			else
				SetArrayElement globalarray ArrayName = highway_pos_table index = (<Player> -1) NewValue = ($highway_guitar1)
			endif
		endif
		yield \{'setup_highway'}
		if (($tutorial_disable_hud = 0) && (<player_on_screen> = 1) && ($end_credits = 0))
			reset_hud <...>
		endif
		yield
		if (<player_on_screen> = 1)

			if (<loading_transition> = 1)
				setslomo \{0.001}
			endif
			SpawnScriptNow gem_scroller params = {<...>}
		else

			createplayerserver id = <player_status> Player = <Player>
			addnetworkplayeroutputs id = <player_status> Player = <Player> onscreen = 0
		endif
		yield \{'ss gem_scroller'}
		if ((($<player_status>.part) != vocals) && (<player_on_screen> = 1))
			SpawnScriptNow button_checker params = {<...>}
		endif
		yield
		if ($<player_status>.is_local_client = 1)
			SpawnScriptLater check_for_star_power params = {<...>}
		endif
		yield
		if ((<calc_score> = true) && (<player_on_screen> = 1))
			calc_songscoreinfo player_status = <player_status>
		endif
		if NOT GotParam \{no_score_update}
			SpawnScriptLater update_score_fast params = {player_status = <player_status> player_on_screen = <player_on_screen>}
		endif
		Player = (<Player> + 1)
		repeat <num_players>
	endif
	yield
	yield
	setup_band_hud
	yield \{'setup_band_hud'}
	GetPakManCurrent \{map = zones}
	yield
	if (<loading_transition> = 0)
		if (<training_mode> = 0)
			if NOT ($game_mode = practice)
				apply_band_logo_to_venue \{step = apply}
			endif
		endif
	endif
	yield
	GH3_Set_Guitar_Verb_And_Echo_to_Dry
	setupsongdspnetworks song_name = <song_name>
	if (<song_name> = jamsession)
		begin_jam_song
	endif
	yield
	if (<loading_transition> = 1)

		mark_safe_for_shutdown
		setslomo \{$current_speedfactor}
		Transition_Wait
		Change \{playing_song = 1}
		yield \{'Transition_Wait'}
		setslomo \{0.001}
		Transition_GetTime Type = ($current_transition)
		songtime = (0 - <transition_time> - <transition_lag_offset> - <transition_lag_offset>)
		reset_song_time starttime = <songtime>
	endif
	yield
	Transition_Play Type = ($current_transition)
	Change \{current_transition = None}
	yield \{'Transition_Play'}
	Change \{check_for_unplugged_controllers = 1}
	yield
	WaitOneGameFrame
	yield \{'wait 1 gameframe'}
	if (<loading_transition> = 0)
		yield \{'StopRendering'}
		if ($end_credits = 0)
			destroy_loading_screen
		endif
		yield
	else
		destroy_loading_screen
		yield
	endif
	setslomo \{$current_speedfactor}
	yield
	SpawnScriptNow begin_song_after_intro params = {starttimeafterintro = <starttimeafterintro>}
	achievements_resetgreenhellflags
	Player = 1
	begin
	init_star_power_debug Player = <Player>
	Player = (<Player> + 1)
	repeat $current_num_players
	yield
	mark_safe_for_shutdown
	resetwhammycachedrows
	Change disable_note_input = <note_input>
	Player = 1
	begin
	<player_status> = ($0x2994109a [<Player>])
	EnableInput OFF controller = ($<player_status>.controller)
	Player = (<Player> + 1)
	repeat $current_num_players
	0x821ec1ac \{'*_*'}
endscript

script in_the_round_check 
	if ($game_mode = practice || $game_mode = p2_pro_faceoff)
		return
	endif
	song = $current_song
	level_checksum = $current_level
	if StructureContains structure = ($gh_songlist_props.<song>) in_the_round
		if (($gh_songlist_props.<song>.in_the_round) = 1)
			if NOT StructureContains structure = ($LevelZones.<level_checksum>) in_the_round

			endif
		endif
	endif
endscript

script begin_song_after_intro 
	begin
	GetSongTimeMs
	if (<time> >= <starttimeafterintro>)
		break
	endif
	WaitOneGameFrame
	repeat
	begin_song
	Change \{playing_song_for_real = 1}
	if NOT ($is_attract_mode = 1)
		enable_pause
	endif
endscript

script kill_gem_scroller \{no_render = 0
		Type = Normal
		training_mode = 0}
	Change \{playing_song_for_real = 0}
	if (<Type> = Normal)
		mark_unsafe_for_shutdown

		if NOT GotParam \{restarting}
			StopRendering
		endif
		disable_highway_prepass

		invalidate_globaltags

	endif

	Change \{crowd_in_jam_mode_song_state = 0}
	Change \{crowd_in_front_end_state = 1}
	Change last_start_pressed_device = ($primary_controller)
	printmissingdrumpatterns
	if NOT (<Type> = restart)
		LaunchGemEvent \{event = kill_objects}
		destroyplayerserver \{id = all}
		begin
		if ($practice_songpreview_changing = 0)
			break
		endif
		Wait \{1
			gameframe}
		repeat
		songunload
		Kill_StarPower_Camera \{changecamera = 0}
		kill_group_starpower_anim
		Kill_Walk_Camera \{changecamera = 0}
		Change \{structurename = player1_status
			star_power_amount = 0}
		Change \{structurename = player2_status
			star_power_amount = 0}
		Change \{structurename = player3_status
			star_power_amount = 0}
		Change \{structurename = player4_status
			star_power_amount = 0}
		Kill_StarPower_StageFX player_text = ($player1_status.text) player_status = player1_status ifEmpty = 0
		Kill_StarPower_StageFX player_text = ($player2_status.text) player_status = player2_status ifEmpty = 0
		Kill_StarPower_StageFX player_text = ($player3_status.text) player_status = player3_status ifEmpty = 0
		Kill_StarPower_StageFX player_text = ($player4_status.text) player_status = player4_status ifEmpty = 0
		Change \{showing_raise_axe = 0}
		practicemode_deinit
		notemap_deinit
		KillSpawnedScript \{Name = Do_StarPower_TeslaFX}
		KillSpawnedScript \{Name = Create_StarPower_TeslaFX}
	endif
	if NOT (<Type> = outro)
		if ScreenElementExists \{id = starpower_container_leftp1}
			legacydoscreenelementmorph \{id = starpower_container_leftp1
				alpha = 0}
		endif
		if ScreenElementExists \{id = starpower_container_leftp2}
			legacydoscreenelementmorph \{id = starpower_container_leftp2
				alpha = 0}
		endif
		if ScreenElementExists \{id = starpower_container_rightp1}
			legacydoscreenelementmorph \{id = starpower_container_rightp1
				alpha = 0}
		endif
		if ScreenElementExists \{id = starpower_container_rightp2}
			legacydoscreenelementmorph \{id = starpower_container_rightp2
				alpha = 0}
		endif
		kill_debug_elements
		GuitarEvent_ExitVenue
		destroy_credits_menu
		deinit_star_power_debug
		KillSpawnedScript \{Name = move_2d_elements_to_default}
		KillSpawnedScript \{Name = wait_and_play_you_rock_movie}
		KillSpawnedScript \{Name = star_power_activate_and_drain}
		KillSpawnedScript \{Name = highway_pulse_multiplier_loss}
		kill_pulsate_star_power_bulbs \{Player = 1}
		kill_pulsate_star_power_bulbs \{Player = 2}
		KillSpawnedScript \{Name = guitar_jam_playback_recording}
		KillSpawnedScript \{Name = guitar_jam_drum_playback}
		KillSpawnedScript \{Name = jam_input_whammy_spawned}
		jam_stop_all_samples
		jam_deinit_reverb
	endif
	getmaxplayers
	Player = 1
	begin
	<player_status> = ($0x2994109a [<Player>])
	<player_text> = ($0x57e22f28 [<Player>])
	if NOT (<Type> = outro)
		Change structurename = <player_status> star_power_used = 0
		Change structurename = <player_status> whammy_on = 0
	endif
	if NOT (<Type> = outro)
		destroy_highway <...>
	endif
	if NOT (<Type> = restart)
		GuitarEvent_KillSong <...> loading_transition = 1
		destroy_hud player_text = <player_text> Player = <Player>
		vocals_destroy_highway Player = <Player>
		faceoff_deinit <...>
		faceoff_volumes_deinit <...>
	endif
	Player = (<Player> + 1)
	repeat <max_players>
	vocals_mute_all_mics \{mute = true}
	if NOT (<Type> = restart)
		destroy_band_hud
		kill_startup_script <...>
		KillSpawnedScript \{Name = GuitarEvent_MissedNote}
		KillSpawnedScript \{Name = GuitarEvent_UnnecessaryNote}
		KillSpawnedScript \{Name = GuitarEvent_HitNotes}
		KillSpawnedScript \{Name = GuitarEvent_HitNote}
		KillSpawnedScript \{Name = GuitarEvent_StarPowerOn}
		KillSpawnedScript \{Name = GuitarEvent_StarPowerOff}
		KillSpawnedScript \{Name = GuitarEvent_StarHitNote}
		KillSpawnedScript \{Name = GuitarEvent_StarSequenceBonus}
		KillSpawnedScript \{Name = GuitarEvent_StarMissNote}
		KillSpawnedScript \{Name = GuitarEvent_WhammyOn}
		KillSpawnedScript \{Name = GuitarEvent_WhammyOff}
		KillSpawnedScript \{Name = GuitarEvent_StarWhammyOn}
		KillSpawnedScript \{Name = GuitarEvent_StarWhammyOff}
		KillSpawnedScript \{Name = GuitarEvent_Note_Window_Open}
		KillSpawnedScript \{Name = GuitarEvent_Note_Window_Close}
		KillSpawnedScript \{Name = GuitarEvent_crowd_poor_medium}
		KillSpawnedScript \{Name = GuitarEvent_crowd_medium_good}
		KillSpawnedScript \{Name = GuitarEvent_crowd_medium_poor}
		KillSpawnedScript \{Name = GuitarEvent_crowd_good_medium}
		KillSpawnedScript \{Name = GuitarEvent_CreateFirstGem}
		KillSpawnedScript \{Name = highway_pulse_black}
		KillSpawnedScript \{Name = GuitarEvent_HitNote_Spawned}
		KillSpawnedScript \{Name = hit_note_fx}
		KillSpawnedScript \{Name = Do_StarPower_StageFX}
		KillSpawnedScript \{Name = Do_StarPower_Camera}
		KillSpawnedScript \{Name = first_gem_fx}
		KillSpawnedScript \{Name = gem_iterator}
		KillSpawnedScript \{Name = gem_array_stepper}
		KillSpawnedScript \{Name = gem_array_events}
		KillSpawnedScript \{Name = gem_step}
		KillSpawnedScript \{Name = gem_step_end}
		KillSpawnedScript \{Name = drumkit_anim_iterator}
		KillSpawnedScript \{Name = WatchForStartPlaying_iterator}
		band_disabletempoiterator
		KillSpawnedScript \{Name = tempo_matching_iterator}
		KillSpawnedScript \{Name = momentcamera_playanim_spawned}
		clearmeasurecallbacks
		clearbeatcallbacks
		KillSpawnedScript \{Name = gem_scroller}
		KillSpawnedScript \{Name = button_checker}
		KillSpawnedScript \{Name = check_buttons}
		KillSpawnedScript \{Name = fretbar_update_tempo}
		KillSpawnedScript \{Name = fretbar_update_hammer_on_tolerance}
		KillSpawnedScript \{Name = move_whammy}
		KillSpawnedScript \{Name = create_fretbar}
		KillSpawnedScript \{Name = move_highway_2d}
		KillSpawnedScript \{Name = move_highway_2d_off}
		KillSpawnedScript \{Name = update_score_fast}
		KillSpawnedScript \{Name = check_for_star_power}
		KillSpawnedScript \{Name = wait_for_inactive}
		KillSpawnedScript \{Name = GuitarEvent_PreFretbar}
		KillSpawnedScript \{Name = GuitarEvent_Fretbar}
		KillSpawnedScript \{Name = pulsate_all_star_power_bulbs}
		KillSpawnedScript \{Name = pulsate_star_power_bulb}
		KillSpawnedScript \{Name = rock_meter_star_power_on}
		KillSpawnedScript \{Name = rock_meter_star_power_off}
		KillSpawnedScript \{Name = hud_activated_star_power}
		KillSpawnedScript \{Name = hud_move_note_scorebar}
		KillSpawnedScript \{Name = hud_flash_red_bg_p1}
		KillSpawnedScript \{Name = hud_flash_red_bg_p2}
		KillSpawnedScript \{Name = hud_flash_red_bg_kill}
		KillSpawnedScript \{Name = hud_lightning_alert}
		KillSpawnedScript \{Name = hud_show_note_streak_combo}
		KillSpawnedScript \{Name = net_check_buttons}
		KillSpawnedScript \{Name = net_whammy_pitch_shift}
		KillSpawnedScript \{Name = net_control_whammy_pitch_loop}
		KillSpawnedScript \{Name = show_star_power_ready}
		KillSpawnedScript \{Name = hud_glowburst_alert}
		Change \{star_power_ready_on_p1 = 0}
		Change \{star_power_ready_on_p2 = 0}
		KillSpawnedScript \{Name = event_iterator}
		KillSpawnedScript \{Name = win_song}
		KillSpawnedScript \{Name = hand_note_iterator}
		KillSpawnedScript \{Name = kill_object_later}
		KillSpawnedScript \{Name = show_coop_raise_axe_for_starpower}
		KillSpawnedScript \{Name = net_whammy_pitch_shift}
		KillSpawnedScript \{Name = Crowd_AllPlayAnim}
		KillSpawnedScript \{Name = hud_activated_star_power_spawned}
		KillSpawnedScript \{Name = play_intro}
		KillSpawnedScript \{Name = begin_song_after_intro}

		KillSpawnedScript \{id = song_event_scripts}

		Destroy_AllWhammyFX
		destroy_intro
	endif
	if NOT (<Type> = outro)
		KillSpawnedScript \{Name = move_highway_prepass}
		KillSpawnedScript \{Name = waitandkillhighway}
		KillSpawnedScript \{Name = testlevel_debug}
		KillSpawnedScript \{Name = online_win_song}
		destroy_net_popup
		destroy_gamertags
		LightShow_Shutdown
		DestroyParticlesByGroupID \{groupID = zoneparticles}
		Transition_KillAll
		KillSpawnedScript \{Name = GuitarEvent_SongFailed_Spawned}
		if NOT GotParam \{for_credits_venue}
			KillSpawnedScript \{Name = GuitarEvent_SongWon_Spawned}
			KillSpawnedScript \{Name = cheer_before_explosion}
			KillSpawnedScript \{Name = You_Rock_Waiting_Crowd_SFX}
			KillSpawnedScript \{Name = waitandkillhighway}
			KillSpawnedScript \{Name = wait_and_play_you_rock_movie}
			KillSpawnedScript \{Name = create_exploding_text}
		endif
		deinit_jam_audio \{keep_drumkit}
	endif
	if (<Type> = outro)
		if GotParam \{kill_cameracuts_iterator}
			KillSpawnedScript \{Name = cameracuts_iterator}
		endif
		end_song <...>
	endif
	if (<Type> = Normal)
		hud_flash_red_bg_kill \{Player = 1}
		hud_flash_red_bg_kill \{Player = 2}
		KillSpawnedScript \{id = zone_scripts}
		GetPakManCurrentName \{map = zones}
		formatText checksumName = zone_killsong '%s_KillSong' s = <pakname>
		if ScriptExists <zone_killsong>
			<zone_killsong>
		endif
		LS_ResetVenueLights
		if (<training_mode> = 0)
			if NOT ($game_mode = practice)
				destroy_movie_viewport
			endif
		endif
		destroy_crowd_models
		destroy_bg_viewport
		if ($ps2_gameplay_restart_song = 0)
			unload_songqpak
		endif
		if (<training_mode> = 0)
			if ($ps2_gameplay_restart_song = 0)
				destroy_band
			endif
		endif
		destroy_vocalist_dummy
		destroy_all_camera_lock_targets
		destroy_cameracuts
		if ($debug_showmeasures = On)
			if ScreenElementExists \{id = debug_measures_text}
				debug_measures_text :se_setprops \{Hide}
			else
				Change \{debug_showmeasures = OFF}
				toggle_showmeasures \{for_autolaunch}
			endif
		endif
		if ($debug_showsongtime = On)
			if ScreenElementExists \{id = debug_songtime_text}
				debug_songtime_text :se_setprops \{Hide}
			else
				Change \{debug_showsongtime = OFF}
				toggle_showsongtime
			endif
		endif
		if ($debug_showsongstars = On)
			if ScreenElementExists \{id = debug_songstars_text}
				debug_songstars_text :se_setprops \{Hide}
			else
				Change \{debug_showsongstars = OFF}
				toggle_showsongstars
			endif
		endif
		Change \{structurename = guitarist_info
			stance = stance_frontend}
		Change \{structurename = guitarist_info
			next_stance = stance_frontend}
		Change \{structurename = guitarist_info
			current_anim = Idle}
		Change \{structurename = guitarist_info
			cycle_anim = true}
		Change \{structurename = guitarist_info
			next_anim = None}
		Change \{structurename = guitarist_info
			playing_missed_note = FALSE}
		Change \{structurename = bassist_info
			stance = stance_frontend}
		Change \{structurename = bassist_info
			next_stance = stance_frontend}
		Change \{structurename = bassist_info
			current_anim = Idle}
		Change \{structurename = bassist_info
			cycle_anim = true}
		Change \{structurename = bassist_info
			next_anim = None}
		Change \{structurename = bassist_info
			playing_missed_note = FALSE}
		destroy_debug_measure_text
		kill_character_scripts
		Change \{check_for_unplugged_controllers = 0}
		shut_down_practice_mode
		destroy_menu \{menu_id = you_rock_container}
		KillMovie \{textureSlot = 1}
	endif
	if (<Type> = Normal)

		Wait \{2
			gameframes}

		if NOT GotParam \{restarting}
			if NOT ($0xa025a029 = '')
				UnLoadPak \{$0xa025a029
					Heap = heap_cas}
				Change \{0xa025a029 = ''}
			endif
			if ($game_mode = tutorial)

			else
				if NOT ui_event_exists_in_stack \{Name = 'jam'}
					0xc1c4e84c \{mode = FrontEnd}
				else
					0xc1c4e84c \{mode = jammode
						0xd607e2e6 = 1}
				endif
			endif
		endif
		if NOT GotParam \{restarting}
			end_song
			anim_paks_set_state \{state = FrontEnd
				async = 0}
		endif
		if NOT (<no_render> = 1)
			if ($shutdown_game_for_signin_change_flag = 0)
				StartRendering
			endif
		endif

		mark_safe_for_shutdown
		Change \{playing_song = 0}
		broadcastevent \{Type = kill_gem_scroller_done}
	endif
	destroy_band_failing_vignette
	if (<Type> = Normal)
		if NOT GotParam \{restarting}
			StartRendering
		endif
	endif
endscript

script restart_gem_scroller \{no_render = 0
		loading_transition = 0
		restarting = 1}
	yield
	mark_unsafe_for_shutdown
	disable_pause
	yield
	if (<loading_transition> = 0)
		PauseGame
	endif
	LaunchEvent \{Type = unfocus
		target = root_window}
	yield

	if (<loading_transition> = 0)
		kill_gem_scroller no_render = <no_render> restarting
		mark_unsafe_for_shutdown
	endif
	yield \{'kill_gem_scroller'}
	start_gem_scroller {<...> 0x97cb575b}
	yield
	Change \{check_for_unplugged_controllers = 1}
	UnBindGuitarControllerStatus
	yield
	LaunchEvent \{Type = focus
		target = root_window}
	yield
	KillSpawnedScript \{Name = yieldmonitor}
	if (<loading_transition> = 0)
		do_gh3_unpause
	endif
endscript

script reset_song_time \{starttime = 0}
	Change current_deltatime = (1.0 / 60.0)
	Change current_time = (<starttime> / 1000.0)
	ResetSongTimer starttime = (<starttime> / 1000.0)
endscript

script fill_input_array 
	FillInputArray <...>
endscript

script create_gem 
	if (<delay> > 0)
		begin
		WaitOneGameFrame
		<time> = (<time> + ($current_deltatime * 1000.0))
		repeat <delay>
	endif
	Create2DGem <...>
endscript

script gem_iterator \{song_name = test
		difficulty = easy
		array_type = qs(0x13e59f9f)
		not_player_specific = FALSE
		add_part_to_event_id = FALSE}
	if (<not_player_specific> = FALSE)
		SpawnScriptNow gem_array_events params = {<...>}
	endif
	if (<not_player_specific> = FALSE)
		if playerinfoequals <Player> part = vocals
			return
		endif
	endif
	if GotParam \{use_input_array}
		get_difficulty_text_nl difficulty = <difficulty> no_rhythm
		SpawnScriptNow gem_array_stepper params = {<...>}
	else
		SpawnScriptNow gem_array_stepper params = {<...> difficulty = easy difficulty_text_nl = 'easy'}
		SpawnScriptNow gem_array_stepper params = {<...> difficulty = medium difficulty_text_nl = 'medium'}
		SpawnScriptNow gem_array_stepper params = {<...> difficulty = hard difficulty_text_nl = 'hard'}
		SpawnScriptNow gem_array_stepper params = {<...> difficulty = expert difficulty_text_nl = 'expert'}
	endif
endscript

script gem_array_events \{not_player_specific = FALSE
		add_part_to_event_id = FALSE}
	getplayerinfo <Player> difficulty
	get_difficulty_text_nl difficulty = <difficulty> no_rhythm
	get_notetrack_part_text Player = <Player>

	ClearEventHandlerGroup \{iterator_group}
	if (<not_player_specific> = FALSE)
		extendcrcplayer gem_step_event <Player> out = id
	elseif (<add_part_to_event_id> = true)
		ExtendCrc gem_step_event <part> out = id
	else
		id = gem_step_event
	endif
	ExtendCrc <id> <iterator_text> out = id
	ExtendCrc <id> <difficulty_text_nl> out = id
	SetEventHandler response = call_script event = <id> Scr = gem_step params = {<...>} group = iterator_group
	if (<not_player_specific> = FALSE)
		extendcrcplayer gem_step_begin <Player> out = id
	elseif (<add_part_to_event_id> = true)
		ExtendCrc gem_step_begin <part> out = id
	else
		id = gem_step_begin
	endif
	ExtendCrc <id> <iterator_text> out = id
	ExtendCrc <id> <difficulty_text_nl> out = id
	SetEventHandler response = call_script event = <id> Scr = gem_step_begin params = {<...>} group = iterator_group
	if (<not_player_specific> = FALSE)
		extendcrcplayer gem_step_end <Player> out = id
	elseif (<add_part_to_event_id> = true)
		ExtendCrc gem_step_end <part> out = id
	else
		id = gem_step_end
	endif
	ExtendCrc <id> <iterator_text> out = id
	ExtendCrc <id> <difficulty_text_nl> out = id
	SetEventHandler response = call_script event = <id> Scr = gem_step_end params = {<...>} group = iterator_group
	if NOT GotParam \{use_input_array}
		extendcrcplayer restart_gem_array_events <Player> out = id
		SetEventHandler response = switch_script event = <id> Scr = gem_array_events params = {<...>} group = iterator_group
	endif

	Block
endscript

script gem_step 
	GemStep
endscript

script gem_step_begin 
endscript

script gem_step_end 
endscript

script gem_array_stepper 
	gem_array_stepper_CFunc_Setup
	begin
	if gem_array_stepper_CFunc
		break
	endif
	WaitOneGameFrame
	repeat
	gem_array_stepper_CFunc_Cleanup
endscript

script default_startup 
endscript

script call_startup_scripts 
	Change \{current_startup_script = default_startup}
	GetGlobalTags \{user_options
		attract_mode_fix = 1}
	get_song_struct song = <song_name>
	setlagoffsets song_struct = <song_struct>
	if StructureContains structure = <song_struct> Name = startup_Script
		Change current_startup_script = (<song_struct>.startup_Script)
	endif
	if StructureContains structure = <song_struct> Name = exit_Script
		Change current_exit_script = (<song_struct>.exit_Script)
	else
	endif
	if StructureContains structure = <song_struct> Name = hammer_on_measure_scale
		Change hammer_on_measure_scale = (<song_struct>.hammer_on_measure_scale)
	else
		Change \{hammer_on_measure_scale = $default_hammer_on_measure_scale}
	endif
	SpawnScriptNow ($current_startup_script) params = {<...>}
endscript

script addlagoffsets 
	audio_lag_ms = 0
	gem_lag_ms = 0
	input_lag_ms = 0
	drum_midi_lag_ms = 0
	prefretbar_time = 0
	GetPlatform
	if StructureContains structure = <settings> Name = <Platform>
		AddParams (<settings>.<Platform>)
	endif
	Change time_audio_offset = ($time_audio_offset + <audio_lag_ms>)
	Change time_gem_offset = ($time_gem_offset + <gem_lag_ms>)
	Change time_input_offset = ($time_input_offset + <input_lag_ms>)
	Change time_drum_midi_offset = ($time_drum_midi_offset + <drum_midi_lag_ms>)
	Change prefretbar_time = ($prefretbar_time + <prefretbar_time>)
endscript

script setlagoffsets 
	Change \{time_audio_offset = 0.0}
	Change \{time_gem_offset = 0.0}
	Change \{time_input_offset = 0.0}
	Change \{time_drum_midi_offset = 0.0}
	Change \{prefretbar_time = 0.0}
	addlagoffsets settings = ($default_lag_settings)
	practice_settings = None
	if ($game_mode = practice && $current_speedfactor != 1.0)
		if NOT ($player1_status.part = drum)
			if ($current_speedfactor >= 0.8)
				practice_settings = practice_slow_lag_settings
			elseif ($current_speedfactor >= 0.6)
				practice_settings = practice_slower_lag_settings
			else
				practice_settings = practice_slowest_lag_settings
			endif
		else
			if ($current_speedfactor >= 0.8)
				practice_settings = practice_drum_slow_lag_settings
			elseif ($current_speedfactor >= 0.6)
				practice_settings = practice_drum_slower_lag_settings
			else
				practice_settings = practice_drum_slowest_lag_settings
			endif
		endif
	endif
	if NOT (<practice_settings> = None)
		addlagoffsets settings = ($<practice_settings>)
	endif
	if StructureContains structure = <song_struct> Name = gem_offset
		Change time_gem_offset = ($time_gem_offset + (<song_struct>.gem_offset))
	endif
	if StructureContains structure = <song_struct> Name = input_offset
		Change time_input_offset = ($time_input_offset + (<song_struct>.input_offset))
	endif
endscript

script kill_startup_script 
	if NOT ($current_startup_script = nothing)
		KillSpawnedScript Name = ($current_startup_script)
	endif
	if NOT ($current_exit_script = nothing)
		SpawnScriptNow ($current_exit_script) params = {<...>}
	endif
endscript

script Load_Venue \{block_scripts = 0
		force_venue_reload = 0}
	GetPakManCurrent \{map = zones}
	if GotParam \{pak}
		if NOT StructureContains \{structure = $LevelZones
				$current_level}

		endif
		0x3631c4e9 = (($LevelZones.$current_level).zone)
		if 0xd1249523 0x3631c4e9 = <0x3631c4e9>
			if NOT 0x2e51d96c
				0x11a515a1
			endif
			loadvenuevideo pn = <0x3631c4e9>
		else
			if 0x2e51d96c
				0x29472091
			endif
		endif


		force_venue_reload = 1
		if (<force_venue_reload> = 1)
			pak = None
		endif
		if (<pak> = (($LevelZones.$current_level).zone))
			Transitions_ResetZone
			return
		else
			0x776e192b

			destroy_crowd_models
			SetPakManCurrentBlock \{map = zones
				pak = None}

		endif
	else

		ResetWaypoints
	endif
	ResetPulseEvents
	if NOT SetPakManCurrentBlock map = zones pak = (($LevelZones.$current_level).zone) block_scripts = <block_scripts>
		DownloadContentLost
		return
	endif
	setup_all_crowd_sounds_based_on_zone
	GH3_Change_crowd_reverb_settings_by_Venue
	if NodeFlagExists \{NODEFLAG_VIEWERLIGHTS}
		if ($current_level = load_z_viewer ||
				$current_level = viewer)
			ChangeNodeFlag \{NODEFLAG_VIEWERLIGHTS
				0}
			ChangeNodeFlag \{NODEFLAG_VIEWERLIGHTS
				1}
			($default_loading_screen.Destroy)
		else
			ChangeNodeFlag \{NODEFLAG_VIEWERLIGHTS
				0}
		endif
	endif
	AddToMaterialLibrary \{scene = 'zones/z_in_game/z_in_game.scn'}
endscript

script 0xbbb34620 
	if 0x2e51d96c
		0x29472091
	endif
endscript
0x0fe12f5d = None
0xed4e64b2 = male

script start_song \{device_num = 69
		practice_intro = 0
		endtime = 999999999
		force_venue_reload = 0
		force_encore = 0}
	if (<device_num> = 69)
		<device_num> = ($primary_controller)
	endif
	mark_unsafe_for_shutdown
	if ($is_network_game = 0)
		set_rich_presence_game_mode
		xenon_singleplayer_session_init
	else
		set_rich_presence_game_mode \{online = 1}
	endif
	if NOT ($game_mode = practice)
		0x622f875f
	endif
	Load_Venue
	if ($autotest_on = 1)
		Change current_transition = ($autotest_transition)
	elseif NOT ($debug_current_transition = None)
		Change current_transition = ($debug_current_transition)
	else
		Transition_SelectTransition practice_intro = <practice_intro> force_encore = <force_encore>
	endif
	gamemode_gettype
	if (($is_network_game = 0) || (<Type> = career))
		if NOT GotParam \{starttime}
			if GotParam \{uselaststarttime}
				starttime = ($current_starttime)
			else
				starttime = 0
			endif
		endif
		if NOT GotParam \{difficulty}
			difficulty = ($player1_status.difficulty)
		endif
		if NOT GotParam \{difficulty2}
			difficulty2 = ($player2_status.difficulty)
		endif
		if NOT GotParam \{song_name}
			song_name = ($current_song)
		endif
		if (<song_name> = jamsession)
			Change \{0xdd4f68fd = 1}
		endif
		Change \{0x0fe12f5d = None}
		if NOT ($end_credits = 1)
			restart_gem_scroller {
				song_name = <song_name>
				difficulty = <difficulty>
				difficulty2 = <difficulty2>
				starttime = <starttime>
				practice_intro = <practice_intro>
				endtime = <endtime>
				restarting = 0
			}
		endif
	endif
	Change \{check_for_unplugged_controllers = 1}
	Change \{0xdd4f68fd = 0}
	get_band_name song = ($current_song)
	band_builder_get_cpu_singer_id
	Change 0x0fe12f5d = <Band>
	if GotParam \{singer_id}
		Change 0xed4e64b2 = <singer_id>
	else
		Change \{0xed4e64b2 = None}
	endif
endscript

script yieldmonitor 
	begin
	WaitOneGameFrame
	yieldping
	repeat
endscript

script restart_song \{practice_intro = 0
		loading_transition = 0}
	if ($current_song_qpak = jamsession)
		Change \{0xdd4f68fd = 1}
	endif
	0xd3f993c8 \{full}
	if ($shutdown_game_for_signin_change_flag = 1)
		return
	endif
	mark_unsafe_for_shutdown
	disable_pause
	if (<loading_transition> = 1)
		resetyieldinfo \{yield = true}

		CreateScreenElement \{Type = SpriteElement
			id = 0x6bb63ae6
			parent = root_window
			texture = 0xe40dbad3
			Pos = (640.0, 360.0)
			just = [
				center
				center
			]
			dims = (1280.0, 720.0)
			z_priority = 0}
		KillSpawnedScript \{Name = yieldmonitor}
		SpawnScriptNow \{yieldmonitor}
		yield
		if ($current_song = None)
			Change \{current_song = $old_song}
		endif
		if ($game_mode != tutorial)
			band_playtransitionidles
			bandmanager_stopallanimiterators
			band_unload_anim_paks
			band_unload_song_anim_paks
		endif
		drummer_kill_spawnscripts
		kill_gem_scroller \{Type = restart}
		yield \{'kill_gem_scroller'}
		setup_bg_viewport
		yield \{'setup_bg_viewport'}
		create_cameracuts
		Transition_SelectTransition practice_intro = <practice_intro>
		if ($current_transition = Intro)
			Change \{current_transition = loadingintro}
		endif
		yield
		songtime = 0
		Transition_GetTime \{Type = loading}
		songtime = (<songtime> - <transition_time>)
		Transition_GetTime Type = ($current_transition)
		songtime = (<songtime> - <transition_time>)
		reset_song_time starttime = <songtime>
		yield
		Transition_Play \{Type = loading}
		yield
		if ($ps2_gameplay_restart_song = 0)
			if (<loading_transition> = 1)
				pauseinvenueloadingscreen
			endif
		endif
		yield
		UnPauseGame
		yield
		if ($current_song = jamsession)
			mark_safe_for_shutdown
			Transition_Wait
			Change \{current_transition = fastintro}
			return
		endif
		0xb56773dd = 1
		0x75f38d57 = 0
		if ($game_mode = p1_quickplay || $game_mode = p2_quickplay || $game_mode = p3_quickplay || $game_mode = p4_quickplay)
			0x75f38d57 = 1
		endif
		if ($quickplay_song_list_current > 0 && <0x75f38d57> = 1)
			0xb56773dd = 0
		elseif ($ps2_gameplay_restart_song = 1)
			0xb56773dd = 0
		endif
		if (<0xb56773dd> = 1)
			unload_songqpak
			load_songqpak song_name = ($current_song) async = 1
			band_unload_anim_paks
			band_unload_song_anim_paks
			smartflushpak \{async = 0
				tags = {
					map = animpak
				}}
			smartflushpak \{async = 0
				tags = {
					map = looppak
				}}
			ps2_load_car_part_script
			destroy_band
			Change \{ps2_gameplay_restart_song = 0}
			Change \{finished_gig_band_rebuild = 0}
			Change \{band_builder_no_genre_swaps = 1}
			create_band async = 1 min_time = ($minimum_transition_load_time)
			Change \{band_builder_no_genre_swaps = 0}
			0xce69e479
			unload_songqpak
			WaitOneGameFrame
			load_songqpak song_name = ($current_song) async = 1
			load_song_anims song_name = ($current_song) async = 1
			0xf11ce60b
		else

		endif
		get_song_struct song = ($current_song)
		if StructureContains structure = <song_struct> Name = 0x59cb4f1c
			0x59cb4f1c = (<song_struct>.0x59cb4f1c)
			level_checksum = ($current_level)
			formatText checksumName = venue_checksum 'load_%s' s = ($LevelZones.<level_checksum>.Name)
			if NOT ArrayContains array = $<0x59cb4f1c> contains = <venue_checksum>
				quickplay_choose_random_venue
			endif
		endif
	else

		resetyieldinfo \{yield = FALSE}
		create_loading_screen \{mode = restart_song}
	endif
	yield
	StopSoundEvent \{Crowd_Fail_Song_SFX}
	yield
	if (<loading_transition> = 0 &&
			<practice_intro> = 0)
		if NOT ($debug_current_transition = None)
			Change current_transition = ($debug_current_transition)
		elseif ($current_transition = forceintro)
			Change \{current_transition = fastintro}
			Transition_SelectTransition practice_intro = <practice_intro>
		elseif ($debug_encore)
			Change \{current_transition = restartencore}
		else
			Change \{current_transition = fastintro}
		endif
		get_progression_globals game_mode = ($game_mode) ($current_progression_flag) use_current_tab = 1
		Tier = ($current_gig_number)
		if ($game_mode = gh4_p1_career || $game_mode = gh4_p2_career)
			if Progression_IsEncoreSong tier_global = <tier_global> Tier = <Tier> song = ($current_song)
				Change \{current_transition = restartencore}
			endif
		endif
	endif
	yield \{'Select Transition Logic'}
	UnPauseGame
	yield
	restart_gem_scroller {
		song_name = ($current_song)
		difficulty = ($player1_status.difficulty)
		difficulty2 = ($player2_status.difficulty)
		starttime = ($current_starttime)
		practice_intro = <practice_intro>
		endtime = <endtime>
		loading_transition = <loading_transition>
	}
	Change \{0xdd4f68fd = 0}
	Change \{ps2_gameplay_restart_song = 0}
	if ScreenElementExists \{id = 0x6bb63ae6}
		DestroyScreenElement \{id = 0x6bb63ae6}
	endif
	0xe5a305c6
	UnPauseGame
endscript

script kill_object_later 
	if ScreenElementExists id = <gem_id>
		DestroyGem Name = <gem_id> player_status = <player_status>
	endif
endscript

script debug_flash_star 
	begin
	LaunchGemEvent \{event = debug_star}
	Wait \{8
		gameframes}
	LaunchGemEvent \{event = debug_gem}
	Wait \{8
		gameframes}
	repeat
endscript

script cache_song_end_time 
	gman_songtool_getcurrentsong
	songfilemanager func = get_song_end_time song_name = <current_song>
	cachesongendtime time = <total_end_time>
endscript

script 0x6280a0be 
	get_song_performance song = <song>
	if (<song_performance> = 1)
		return \{true}
	endif
	return \{FALSE}
endscript
