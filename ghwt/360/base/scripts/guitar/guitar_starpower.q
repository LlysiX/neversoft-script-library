whammywibbles = [
	[
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
	]
	[
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
	]
	[
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
	]
	[
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
	]
]

script star_power_reset 
	Change structurename = <player_status> star_power_amount = 0.0
	Change structurename = <player_status> star_power_sequence = 0
	Change structurename = <player_status> star_power_note_count = 0
	Change structurename = <player_status> star_power_used = 0
	Change structurename = <player_status> current_star_array_entry = 0
endscript
star_power_ready_on_p1 = 0
star_power_ready_on_p2 = 0

script show_star_power_ready 
	if ($Cheat_PerformanceMode = 1)
		return
	endif
	if ScreenElementExists \{id = hud_root}
		gamemode_gettype
		if (<Type> = training)
			return
		endif
		if gamemode_isbandscoring
			hud_create_message \{Band
				text = qs(0x8ba36464)
				Priority = 2}
		elseif (($<player_status>.star_power_used) = 0)
			if ($<player_status>.part = vocals)
				vocals_message Player = ($<player_status>.Player) text = qs(0x8ba36464) rgba = [128 240 240 255]
			else
				if (($<player_status>.hud_parent) = alias_g1)
					highway_num = 1
				elseif (($<player_status>.hud_parent) = alias_g2)
					highway_num = 2
				elseif (($<player_status>.hud_parent) = alias_g3)
					highway_num = 3
				endif
				hud_create_message {
					Player = ($<player_status>.Player)
					text = qs(0x8ba36464)
					style_script = hud_message_flame_style_starpower_ready
					style_script_params = {highway_num = <highway_num>}
					Priority = 2
				}
			endif
		endif
		return
	endif
	if ($game_mode = p2_coop || $game_mode = p2_quickplay)
		<player_status> = player1_status
	endif
	if isSinglePlayerGame
		if NOT ($is_attract_mode = 1)
			SoundEvent \{event = star_power_available_gh4}
		endif
	else
		if NOT ($is_attract_mode = 1)
			SpawnScriptNow star_power_ready_sfx_multiplayer params = {Player = ($<player_status>.Player)}
		endif
	endif
	SpawnScriptNow rock_meter_star_power_on params = {player_status = <player_status>}
	formatText checksumName = player_container 'HUD_Note_Streak_Combo%d' d = ($<player_status>.Player)
	begin
	if NOT ScreenElementExists id = <player_container>
		break
	endif
	Wait \{1
		gameframe}
	repeat
	if ($<player_status>.star_power_used = 1)
		return
	endif
	if ($<player_status>.Player = 1)
		if ($star_power_ready_on_p1 = 1)
			return
		else
			Change \{star_power_ready_on_p1 = 1}
		endif
	else
		if ($star_power_ready_on_p2 = 1)
			return
		else
			Change \{star_power_ready_on_p2 = 1}
		endif
	endif
	ExtendCrc star_power_ready_text ($<player_status>.text) out = id
	if (($game_mode = p2_faceoff) || ($game_mode = p2_pro_faceoff))
		if ($<player_status>.Player = 1)
			original_pos = (($hud_screen_elements [0].Pos) - (225.0, 50.0))
		else
			original_pos = (($hud_screen_elements [0].Pos) + (225.0, -50.0))
		endif
		base_scale = 0.8
		scale_big_mult = 1.2
	else
		if ($game_mode = p2_career || $game_mode = p2_coop || $game_mode = p2_quickplay)
			original_pos = (($hud_screen_elements [0].Pos) - (0.0, 60.0))
		else
			original_pos = (($hud_screen_elements [0].Pos) - (0.0, 20.0))
		endif
		base_scale = 1.2
		scale_big_mult = 1.5
	endif
	if ScreenElementExists id = <id>
		<id> :legacydomorph Pos = <original_pos> Scale = 4 rgba = [190 225 255 250] alpha = 0 rot_angle = 3
	endif
	ExtendCrc hud_destroygroup_window ($<player_status>.text) out = hud_destroygroup
	SpawnScriptNow hud_lightning_alert params = {player_status = <player_status> Player = ($<player_status>.Player) alert_id = <id> player_container = <hud_destroygroup>}
	if ScreenElementExists id = <id>
		<id> :legacydomorph Pos = <original_pos> Scale = <base_scale> alpha = 1 time = 0.3 rot_angle = -3 motion = ease_in
	endif
	if ScreenElementExists id = <id>
		<id> :legacydomorph Pos = <original_pos> Scale = (<base_scale> * <scale_big_mult>) time = 0.3 rot_angle = 4 motion = ease_out
	endif
	if ScreenElementExists id = <id>
		<id> :legacydomorph Pos = <original_pos> Scale = <base_scale> time = 0.3 rot_angle = -5 rgba = [145 215 235 250] motion = ease_in
	endif
	rotation = 10
	begin
	<rotation> = (<rotation> * -0.7)
	if ScreenElementExists id = <id>
		<id> :legacydomorph Pos = <original_pos> rot_angle = <rotation> alpha = 1 time = 0.08 motion = ease_out
	endif
	repeat 12
	if ScreenElementExists id = <id>
		<id> :legacydomorph Pos = <original_pos> rot_angle = 0 motion = ease_out
	endif
	if ScreenElementExists id = <id>
		<id> :legacydomorph Pos = (<original_pos> - (0.0, 230.0)) Scale = (<base_scale> * 0.5) alpha = 0 time = 0.3 motion = ease_in
	endif
	if ($<player_status>.Player = 1)
		Change \{star_power_ready_on_p1 = 0}
	else
		Change \{star_power_ready_on_p2 = 0}
	endif
endscript
showing_raise_axe = 0

script show_coop_raise_axe_for_starpower 
endscript

script reset_star_array 
	get_song_struct song = <song_name>
	get_notetrack_part_text player_status = <player_status> song_name = <song_name>
	count = 0
	begin
	get_song_prefix song = <song_name>
	if (<count> = 0)
		get_difficulty_text_nl difficulty = <difficulty> no_rhythm
	else
		get_difficulty_text_nl \{difficulty = expert}
	endif
	if ($game_mode = p2_battle ||
			$boss_battle = 1)
		formatText checksumName = song '%s_%p%d_starbattlemode' s = <song_prefix> p = <part> d = <difficulty_text_nl> AddToStringLookup
		Change structurename = <player_status> sp_phrases_total = 0
	elseif ($game_mode = p2_faceoff)
		formatText checksumName = song '%s_%pfaceoffstar' s = <song_prefix> p = <part> AddToStringLookup
	else
		formatText checksumName = song '%s_%p%d_star' s = <song_prefix> p = <part> d = <difficulty_text_nl> AddToStringLookup
	endif
	formatText checksumName = drum_unmute '%s_%d_DrumUnmute' s = <song_prefix> d = <difficulty_text_nl> AddToStringLookup
	formatText checksumName = drum_fill '%s_%d_DrumFill' s = <song_prefix> d = <difficulty_text_nl> AddToStringLookup
	GetArraySize $<song>
	if (<array_Size> > 0)
		break
	endif
	count = 1
	repeat 2
	Change structurename = <player_status> current_song_star_array = <song>
	Change structurename = <player_status> current_star_array_entry = 0
	Change structurename = <player_status> current_drum_unmute_array = <drum_unmute>
	Change structurename = <player_status> current_drum_fill_array = <drum_fill>
endscript

script Do_StarPower_StageFX 
	SpawnScriptLater Do_StarPower_TeslaFX id = <scriptID> params = {<...>}
endscript

script Do_StarPower_TeslaFX 
	obj_id = ($<player_status>.band_member)
	if NOT CompositeObjectExists Name = <obj_id>
		return
	endif
	if <obj_id> :ishidden
		return
	endif
	GetPakManCurrent \{map = zones}
	ExtendCrc <pak> '_GFX_TRG_TeslaNode_' out = zonePrefix
	switch ($<player_status>.part)
		case bass
		case guitar
		bone = bone_guitar_body
		case drum
		bone = Bone_IK_Hand_Guitar_R
		case vocals
		bone = bone_mic_microphone
	endswitch
	formatText checksumName = teslaparticlefxid '%p_StarPower_TeslaParticleFX' p = <player_text>
	CreateParticleSystem Name = <teslaparticlefxid> objID = ($<player_status>.band_member) bone = <bone> params_Script = $gp_starpower_teslalightning01
	i = 1
	begin
	switch ($<player_status>.part)
		case bass
		case guitar
		if (RandomInteger (0.0, 1.0) = 0)
			bone = BONE_GUITAR_FRET_POS
		else
			bone = bone_guitar_body
		endif
		case drum
		b = RandomInteger (0.0, 4.0)
		switch <b>
			case 0
			bone = bone_guitar_string_1
			case 1
			bone = Bone_IK_Hand_Guitar_L
			case 2
			bone = Bone_IK_Hand_Guitar_R
			case 3
			bone = BONE_GUITAR_FRET_POS
			case 4
			bone = bone_guitar_body
		endswitch
		case vocals
		b = RandomInteger (0.0, 2.0)
		switch <b>
			case 0
			bone = bone_mic_stand
			case 1
			bone = bone_mic_adjust_height
			case 2
			bone = bone_mic_microphone
		endswitch
	endswitch
	formatText checksumName = scriptID '%p_StarPower_TeslaFX%i' p = <player_text> i = <i>
	formatText checksumName = teslaFXID '%p_StarPower_TeslaFXID%i' p = <player_text> i = <i>
	SpawnScriptLater Create_StarPower_TeslaFX id = <scriptID> params = {
		<...>
		zonePrefix = <zonePrefix>
		teslaFXID = <teslaFXID>
		bone = <bone>
		nodeNum = RandomInteger (1.0, 10.0)
	}
	i = (<i> + 1)
	repeat RandomInteger (2.0, 4.0)
	begin
	Wait RandomFloat (0.1, 1.0) Seconds
	i = RandomInteger (1.0, 4.0)
	formatText checksumName = scriptID '%p_StarPower_TeslaFX%i' p = <player_text> i = <i>
	formatText checksumName = teslaFXID '%p_StarPower_TeslaFXID%i' p = <player_text> i = <i>
	KillSpawnedScript id = <scriptID>
	DeleteTeslaEffectObject Name = <teslaFXID>
	if (<i> = 1 || <i> = 2 || RandomInteger (0.0, 1.0) = 1)
		switch ($<player_status>.part)
			case bass
			case guitar
			if (RandomInteger (0.0, 1.0) = 0)
				bone = BONE_GUITAR_FRET_POS
			else
				bone = bone_guitar_body
			endif
			case drum
			b = RandomInteger (0.0, 4.0)
			switch <b>
				case 0
				bone = bone_guitar_string_1
				case 1
				bone = Bone_IK_Hand_Guitar_L
				case 2
				bone = Bone_IK_Hand_Guitar_R
				case 3
				bone = BONE_GUITAR_FRET_POS
				case 4
				bone = bone_guitar_body
			endswitch
			case vocals
			b = RandomInteger (0.0, 2.0)
			switch <b>
				case 0
				bone = bone_mic_stand
				case 1
				bone = bone_mic_adjust_height
				case 2
				bone = bone_mic_microphone
			endswitch
		endswitch
		SpawnScriptLater Create_StarPower_TeslaFX id = <scriptID> params = {
			<...>
			zonePrefix = <zonePrefix>
			teslaFXID = <teslaFXID>
			bone = <bone>
			nodeNum = RandomInteger (1.0, 10.0)
		}
	endif
	repeat
endscript

script Create_StarPower_TeslaFX 
	create_starpower_teslafx_cfunc_setup
	begin
	if create_starpower_teslafx_cfunc
		break
	endif
	Wait \{1
		gameframe}
	repeat
	create_starpower_teslafx_cfunc_cleanup
endscript

script Kill_StarPower_StageFX \{ifEmpty = 1}
	formatText checksumName = scriptID '%p_StarPower_StageFX' p = <player_text>
	KillSpawnedScript id = <scriptID>
	formatText checksumName = teslaparticlefxid '%p_StarPower_TeslaParticleFX' p = <player_text>
	MangleChecksums a = <teslaparticlefxid> b = ($<player_status>.band_member)
	if IsCreated <mangled_ID>
		<mangled_ID> :EmitRate rate = 0
		<mangled_ID> :Destroy ifEmpty = <ifEmpty>
	endif
	if (<ifEmpty> = 0)
		DestroyParticlesByGroupID \{groupID = starPowerFX}
	endif
	i = 1
	begin
	formatText checksumName = scriptID '%p_StarPower_TeslaFX%i' p = <player_text> i = <i>
	formatText checksumName = teslaFXID '%p_StarPower_TeslaFXID%i' p = <player_text> i = <i>
	KillSpawnedScript id = <scriptID>
	DeleteTeslaEffectObject Name = <teslaFXID>
	i = (<i> + 1)
	repeat 4
endscript
using_starpower_camera = FALSE

script Do_StarPower_Camera 
	return
	if ($using_starpower_camera = true || $using_walk_camera = true)
		return
	endif
	Change \{using_starpower_camera = true}
	Wait \{1
		gameframe}
	Change \{CameraCuts_AllowNoteScripts = FALSE}
	CameraCuts_SetArrayPrefix \{prefix = 'cameras_starpower'
		changetime = 2500
		length = 7000}
	Wait \{7
		Seconds}
	CameraCuts_SetArrayPrefix \{prefix = 'cameras'}
	Change \{CameraCuts_AllowNoteScripts = true}
	Change \{using_starpower_camera = FALSE}
endscript

script Kill_StarPower_Camera \{changecamera = 1}
	if ($using_starpower_camera = FALSE)
		return
	endif
	KillSpawnedScript \{Name = Do_StarPower_Camera}
	if (<changecamera> = 1)
		CameraCuts_SetArrayPrefix \{prefix = 'cameras'}
	endif
	Change \{CameraCuts_AllowNoteScripts = true}
	Change \{using_starpower_camera = FALSE}
endscript

script set_star_request_pending 
	printf \{qs(0x5e79940c)}
	Wait \{2.5
		Seconds}
	printf \{qs(0xd0d1a1fe)}
endscript
